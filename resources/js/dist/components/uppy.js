var Xn=Object.create;var Fi=Object.defineProperty;var Vn=Object.getOwnPropertyDescriptor;var Jn=Object.getOwnPropertyNames;var Qn=Object.getPrototypeOf,Yn=Object.prototype.hasOwnProperty;var C=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Zn=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Jn(e))!Yn.call(t,i)&&i!==r&&Fi(t,i,{get:()=>e[i],enumerable:!(s=Vn(e,i))||s.enumerable});return t};var Se=(t,e,r)=>(r=t!=null?Xn(Qn(t)):{},Zn(e||!t||!t.__esModule?Fi(r,"default",{value:t,enumerable:!0}):r,t));var ls=C((Ju,Oi)=>{Oi.exports=function(){var e={},r=e._fns={};e.emit=function(n,a,l,d,p,u,h){var c=s(n);c.length&&i(n,c,[a,l,d,p,u,h])},e.on=function(n,a){r[n]||(r[n]=[]),r[n].push(a)},e.once=function(n,a){function l(){a.apply(this,arguments),e.off(n,l)}this.on(n,l)},e.off=function(n,a){var l=[];if(n&&a){var d=this._fns[n],p=0,u=d?d.length:0;for(p;p<u;p++)d[p]!==a&&l.push(d[p])}l.length?this._fns[n]=l:delete this._fns[n]};function s(o){var n=r[o]?r[o]:[],a=o.indexOf(":"),l=a===-1?[o]:[o.substring(0,a),o.substring(a+1)],d=Object.keys(r),p=0,u=d.length;for(p;p<u;p++){var h=d[p];if(h==="*"&&(n=n.concat(r[h])),l.length===2&&l[0]===h){n=n.concat(r[h]);break}}return n}function i(o,n,a){var l=0,d=n.length;for(l;l<d&&n[l];l++)n[l].event=o,n[l].apply(n[l],a)}return e}});var Er=C((Yu,xi)=>{function oa(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}xi.exports=oa});var Ci=C((Zu,Ai)=>{var na=typeof global=="object"&&global&&global.Object===Object&&global;Ai.exports=na});var us=C((ed,Ri)=>{var aa=Ci(),la=typeof self=="object"&&self&&self.Object===Object&&self,ua=aa||la||Function("return this")();Ri.exports=ua});var $i=C((td,ki)=>{var da=us(),pa=function(){return da.Date.now()};ki.exports=pa});var Mi=C((rd,ji)=>{var ca=/\s/;function ha(t){for(var e=t.length;e--&&ca.test(t.charAt(e)););return e}ji.exports=ha});var Li=C((sd,Ni)=>{var fa=Mi(),ma=/^\s+/;function ga(t){return t&&t.slice(0,fa(t)+1).replace(ma,"")}Ni.exports=ga});var ds=C((id,Bi)=>{var ya=us(),va=ya.Symbol;Bi.exports=va});var zi=C((od,Di)=>{var Ii=ds(),qi=Object.prototype,_a=qi.hasOwnProperty,ba=qi.toString,At=Ii?Ii.toStringTag:void 0;function wa(t){var e=_a.call(t,At),r=t[At];try{t[At]=void 0;var s=!0}catch{}var i=ba.call(t);return s&&(e?t[At]=r:delete t[At]),i}Di.exports=wa});var Wi=C((nd,Hi)=>{var Sa=Object.prototype,Pa=Sa.toString;function Ta(t){return Pa.call(t)}Hi.exports=Ta});var Vi=C((ad,Xi)=>{var Ki=ds(),Fa=zi(),Ea=Wi(),Ua="[object Null]",Oa="[object Undefined]",Gi=Ki?Ki.toStringTag:void 0;function xa(t){return t==null?t===void 0?Oa:Ua:Gi&&Gi in Object(t)?Fa(t):Ea(t)}Xi.exports=xa});var Qi=C((ld,Ji)=>{function Aa(t){return t!=null&&typeof t=="object"}Ji.exports=Aa});var Zi=C((ud,Yi)=>{var Ca=Vi(),Ra=Qi(),ka="[object Symbol]";function $a(t){return typeof t=="symbol"||Ra(t)&&Ca(t)==ka}Yi.exports=$a});var so=C((dd,ro)=>{var ja=Li(),eo=Er(),Ma=Zi(),to=NaN,Na=/^[-+]0x[0-9a-f]+$/i,La=/^0b[01]+$/i,Ba=/^0o[0-7]+$/i,Ia=parseInt;function qa(t){if(typeof t=="number")return t;if(Ma(t))return to;if(eo(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=eo(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=ja(t);var r=La.test(t);return r||Ba.test(t)?Ia(t.slice(2),r?2:8):Na.test(t)?to:+t}ro.exports=qa});var no=C((pd,oo)=>{var Da=Er(),ps=$i(),io=so(),za="Expected a function",Ha=Math.max,Wa=Math.min;function Ka(t,e,r){var s,i,o,n,a,l,d=0,p=!1,u=!1,h=!0;if(typeof t!="function")throw new TypeError(za);e=io(e)||0,Da(r)&&(p=!!r.leading,u="maxWait"in r,o=u?Ha(io(r.maxWait)||0,e):o,h="trailing"in r?!!r.trailing:h);function c(E){var P=s,U=i;return s=i=void 0,d=E,n=t.apply(U,P),n}function f(E){return d=E,a=setTimeout(v,e),p?c(E):n}function b(E){var P=E-l,U=E-d,O=e-P;return u?Wa(O,o-U):O}function _(E){var P=E-l,U=E-d;return l===void 0||P>=e||P<0||u&&U>=o}function v(){var E=ps();if(_(E))return F(E);a=setTimeout(v,b(E))}function F(E){return a=void 0,h&&s?c(E):(s=i=void 0,n)}function x(){a!==void 0&&clearTimeout(a),d=0,s=l=i=a=void 0}function A(){return a===void 0?n:F(ps())}function k(){var E=ps(),P=_(E);if(s=arguments,i=this,l=E,P){if(a===void 0)return f(l);if(u)return clearTimeout(a),a=setTimeout(v,e),c(l)}return a===void 0&&(a=setTimeout(v,e)),n}return k.cancel=x,k.flush=A,k}oo.exports=Ka});var cs=C((cd,ao)=>{var Ga=no(),Xa=Er(),Va="Expected a function";function Ja(t,e,r){var s=!0,i=!0;if(typeof t!="function")throw new TypeError(Va);return Xa(r)&&(s="leading"in r?!!r.leading:s,i="trailing"in r?!!r.trailing:i),Ga(t,e,{leading:s,maxWait:e,trailing:i})}ao.exports=Ja});var vs=C((Ed,go)=>{"use strict";go.exports=function(e){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected a number, got ${typeof e}`);let r=e<0,s=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];if(r&&(e=-e),e<1)return`${(r?"-":"")+e} B`;let i=Math.min(Math.floor(Math.log(e)/Math.log(1024)),s.length-1);e=Number(e/1024**i);let o=s[i];return e>=10||e%1===0?`${(r?"-":"")+e.toFixed(0)} ${o}`:`${(r?"-":"")+e.toFixed(1)} ${o}`}});var _o=C((Ud,vo)=>{"use strict";function yo(t,e){this.text=t=t||"",this.hasWild=~t.indexOf("*"),this.separator=e,this.parts=t.split(e)}yo.prototype.match=function(t){var e=!0,r=this.parts,s,i=r.length,o;if(typeof t=="string"||t instanceof String)if(!this.hasWild&&this.text!=t)e=!1;else{for(o=(t||"").split(this.separator),s=0;e&&s<i;s++)r[s]!=="*"&&(s<o.length?e=r[s]===o[s]:e=!1);e=e&&o}else if(typeof t.splice=="function")for(e=[],s=t.length;s--;)this.match(t[s])&&(e[e.length]=t[s]);else if(typeof t=="object"){e={};for(var n in t)this.match(n)&&(e[n]=t[n])}return e};vo.exports=function(t,e,r){var s=new yo(t,r||/[\/\.]/);return typeof e<"u"?s.match(e):s}});var wo=C((Od,bo)=>{var rl=_o(),sl=/[\/\+\.]/;bo.exports=function(t,e){function r(s){var i=rl(s,t,sl);return i&&i.length>=2}return e?r(e.split(";")[0]):r}});var Ls=C((Ep,Hr)=>{(function(){"use strict";var t={}.hasOwnProperty;function e(){for(var i="",o=0;o<arguments.length;o++){var n=arguments[o];n&&(i=s(i,r(n)))}return i}function r(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return e.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var o="";for(var n in i)t.call(i,n)&&i[n]&&(o=s(o,n));return o}function s(i,o){return o?i?i+" "+o:i+o:i}typeof Hr<"u"&&Hr.exports?(e.default=e,Hr.exports=e):typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("classnames",[],function(){return e}):window.classNames=e})()});var dn=C((Qp,un)=>{function he(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}un.exports=he;he.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};he.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};he.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},r),this._options.unref&&this._timer.unref(),!0};he.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};he.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};he.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};he.prototype.start=he.prototype.try;he.prototype.errors=function(){return this._errors};he.prototype.attempts=function(){return this._attempts};he.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,r=0,s=0;s<this._errors.length;s++){var i=this._errors[s],o=i.message,n=(t[o]||0)+1;t[o]=n,n>=r&&(e=i,r=n)}return e}});var pn=C(Qe=>{var Dl=dn();Qe.operation=function(t){var e=Qe.timeouts(t);return new Dl(e,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})};Qe.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var r in t)e[r]=t[r];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],i=0;i<e.retries;i++)s.push(this.createTimeout(i,e));return t&&t.forever&&!s.length&&s.push(this.createTimeout(i,e)),s.sort(function(o,n){return o-n}),s};Qe.createTimeout=function(t,e){var r=e.randomize?Math.random()+1:1,s=Math.round(r*Math.max(e.minTimeout,1)*Math.pow(e.factor,t));return s=Math.min(s,e.maxTimeout),s};Qe.wrap=function(t,e,r){if(e instanceof Array&&(r=e,e=null),!r){r=[];for(var s in t)typeof t[s]=="function"&&r.push(s)}for(var i=0;i<r.length;i++){var o=r[i],n=t[o];t[o]=function(l){var d=Qe.operation(e),p=Array.prototype.slice.call(arguments,1),u=p.pop();p.push(function(h){d.retry(h)||(h&&(arguments[0]=d.mainError()),u.apply(this,arguments))}),d.attempt(function(){l.apply(t,p)})}.bind(t,n),t[o].options=e}}});var hn=C((Zp,cn)=>{cn.exports=pn()});function Tr(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var ea=0;function Ui(t){return"__private_"+ea+++"_"+t}function ta(t,e,r){let s=[];return t.forEach(i=>typeof i!="string"?s.push(i):e[Symbol.split](i).forEach((o,n,a)=>{o!==""&&s.push(o),n<a.length-1&&s.push(r)})),s}function Ei(t,e){let r=/\$/g,s="$$$$",i=[t];if(e==null)return i;for(let o of Object.keys(e))if(o!=="_"){let n=e[o];typeof n=="string"&&(n=r[Symbol.replace](n,s)),i=ta(i,new RegExp(`%\\{${o}\\}`,"g"),n)}return i}var ra=t=>{throw new Error(`missing string: ${t}`)},Ot=Ui("onMissingKey"),xt=Ui("apply"),He=class{constructor(e,r){let{onMissingKey:s=ra}=r===void 0?{}:r;Object.defineProperty(this,xt,{value:sa}),Object.defineProperty(this,Ot,{writable:!0,value:void 0}),this.locale={strings:{},pluralize(i){return i===1?0:1}},Array.isArray(e)?e.forEach(Tr(this,xt)[xt],this):Tr(this,xt)[xt](e),Tr(this,Ot)[Ot]=s}translate(e,r){return this.translateArray(e,r).join("")}translateArray(e,r){let s=this.locale.strings[e];if(s==null&&(Tr(this,Ot)[Ot](e),s=e),typeof s=="object"){if(r&&typeof r.smart_count<"u"){let o=this.locale.pluralize(r.smart_count);return Ei(s[o],r)}throw new Error("Attempted to use a string with plural forms, but no value was given for %{smart_count}")}if(typeof s!="string")throw new Error("string was not a string");return Ei(s,r)}};function sa(t){if(!(t!=null&&t.strings))return;let e=this.locale;Object.assign(this.locale,{strings:{...e.strings,...t.strings},pluralize:t.pluralize||e.pluralize})}var Uo=Se(ls(),1);var ia="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var Fr=(t=21)=>{let e="",r=t;for(;r--;)e+=ia[Math.random()*64|0];return e};var Oo=Se(cs(),1);function Ur(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var Qa=0;function lo(t){return"__private_"+Qa+++"_"+t}var Ya={version:"3.2.2"},We=lo("callbacks"),hs=lo("publish"),Or=class{constructor(){Object.defineProperty(this,hs,{value:Za}),this.state={},Object.defineProperty(this,We,{writable:!0,value:new Set})}getState(){return this.state}setState(e){let r={...this.state},s={...this.state,...e};this.state=s,Ur(this,hs)[hs](r,s,e)}subscribe(e){return Ur(this,We)[We].add(e),()=>{Ur(this,We)[We].delete(e)}}};function Za(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];Ur(this,We)[We].forEach(s=>{s(...e)})}Or.VERSION=Ya.version;var uo=Or;function Ct(t){let e=t.lastIndexOf(".");return e===-1||e===t.length-1?{name:t,extension:void 0}:{name:t.slice(0,e),extension:t.slice(e+1)}}var fs={__proto__:null,md:"text/markdown",markdown:"text/markdown",mp4:"video/mp4",mp3:"audio/mp3",svg:"image/svg+xml",jpg:"image/jpeg",png:"image/png",webp:"image/webp",gif:"image/gif",heic:"image/heic",heif:"image/heif",yaml:"text/yaml",yml:"text/yaml",csv:"text/csv",tsv:"text/tab-separated-values",tab:"text/tab-separated-values",avi:"video/x-msvideo",mks:"video/x-matroska",mkv:"video/x-matroska",mov:"video/quicktime",dicom:"application/dicom",doc:"application/msword",docm:"application/vnd.ms-word.document.macroenabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",xla:"application/vnd.ms-excel",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlc:"application/vnd.ms-excel",xlf:"application/x-xliff+xml",xlm:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroenabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlw:"application/vnd.ms-excel",txt:"text/plain",text:"text/plain",conf:"text/plain",log:"text/plain",pdf:"application/pdf",zip:"application/zip","7z":"application/x-7z-compressed",rar:"application/x-rar-compressed",tar:"application/x-tar",gz:"application/gzip",dmg:"application/x-apple-diskimage"};function Rt(t){var e;if(t.type)return t.type;let r=t.name?(e=Ct(t.name).extension)==null?void 0:e.toLowerCase():null;return r&&r in fs?fs[r]:"application/octet-stream"}function el(t){return t.charCodeAt(0).toString(32)}function po(t){let e="";return t.replace(/[^A-Z0-9]/gi,r=>(e+=`-${el(r)}`,"/"))+e}function co(t){let e="uppy";return typeof t.name=="string"&&(e+=`-${po(t.name.toLowerCase())}`),t.type!==void 0&&(e+=`-${t.type}`),t.meta&&typeof t.meta.relativePath=="string"&&(e+=`-${po(t.meta.relativePath.toLowerCase())}`),t.data.size!==void 0&&(e+=`-${t.data.size}`),t.data.lastModified!==void 0&&(e+=`-${t.data.lastModified}`),e}function tl(t){return!t.isRemote||!t.remote?!1:new Set(["box","dropbox","drive","facebook","unsplash"]).has(t.remote.provider)}function ho(t){if(tl(t))return t.id;let e=Rt(t);return co({...t,type:e})}function ms(t){if(t==null&&typeof navigator<"u"&&(t=navigator.userAgent),!t)return!0;let e=/Edge\/(\d+\.\d+)/.exec(t);if(!e)return!0;let s=e[1].split(".",2),i=parseInt(s[0],10),o=parseInt(s[1],10);return i<15||i===15&&o<15063||i>18||i===18&&o>=18218}function gs(t,e){return e.name?e.name:t.split("/")[0]==="image"?`${t.split("/")[0]}.${t.split("/")[1]}`:"noname"}function ys(t){return t<10?`0${t}`:t.toString()}function bt(){let t=new Date,e=ys(t.getHours()),r=ys(t.getMinutes()),s=ys(t.getSeconds());return`${e}:${r}:${s}`}var fo={debug:()=>{},warn:()=>{},error:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return console.error(`[Uppy] [${bt()}]`,...e)}},mo={debug:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return console.debug(`[Uppy] [${bt()}]`,...e)},warn:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return console.warn(`[Uppy] [${bt()}]`,...e)},error:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return console.error(`[Uppy] [${bt()}]`,...e)}};var xr=Se(vs(),1),So=Se(wo(),1),Po={maxFileSize:null,minFileSize:null,maxTotalFileSize:null,maxNumberOfFiles:null,minNumberOfFiles:null,allowedFileTypes:null,requiredMetaFields:[]},te=class extends Error{constructor(e,r){var s;super(e),this.isRestriction=!0,this.isUserFacing=(s=r?.isUserFacing)!=null?s:!0,r!=null&&r.file&&(this.file=r.file)}},Ar=class{constructor(e,r){this.i18n=r,this.getOpts=()=>{var s;let i=e();if(((s=i.restrictions)==null?void 0:s.allowedFileTypes)!=null&&!Array.isArray(i.restrictions.allowedFileTypes))throw new TypeError("`restrictions.allowedFileTypes` must be an array");return i}}validateAggregateRestrictions(e,r){let{maxTotalFileSize:s,maxNumberOfFiles:i}=this.getOpts().restrictions;if(i&&e.filter(n=>!n.isGhost).length+r.length>i)throw new te(`${this.i18n("youCanOnlyUploadX",{smart_count:i})}`);if(s){let o=e.reduce((n,a)=>{var l;return n+((l=a.size)!=null?l:0)},0);for(let n of r)if(n.size!=null&&(o+=n.size,o>s))throw new te(this.i18n("exceedsSize",{size:(0,xr.default)(s),file:n.name}))}}validateSingleFile(e){let{maxFileSize:r,minFileSize:s,allowedFileTypes:i}=this.getOpts().restrictions;if(i&&!i.some(n=>n.includes("/")?e.type?(0,So.default)(e.type.replace(/;.*?$/,""),n):!1:n[0]==="."&&e.extension?e.extension.toLowerCase()===n.slice(1).toLowerCase():!1)){let n=i.join(", ");throw new te(this.i18n("youCanOnlyUploadFileTypes",{types:n}),{file:e})}if(r&&e.size!=null&&e.size>r)throw new te(this.i18n("exceedsSize",{size:(0,xr.default)(r),file:e.name}),{file:e});if(s&&e.size!=null&&e.size<s)throw new te(this.i18n("inferiorSize",{size:(0,xr.default)(s)}),{file:e})}validate(e,r){r.forEach(s=>{this.validateSingleFile(s)}),this.validateAggregateRestrictions(e,r)}validateMinNumberOfFiles(e){let{minNumberOfFiles:r}=this.getOpts().restrictions;if(r&&Object.keys(e).length<r)throw new te(this.i18n("youHaveToAtLeastSelectX",{smart_count:r}))}getMissingRequiredMetaFields(e){let r=new te(this.i18n("missingRequiredMetaFieldOnFile",{fileName:e.name})),{requiredMetaFields:s}=this.getOpts().restrictions,i=[];for(let o of s)(!Object.hasOwn(e.meta,o)||e.meta[o]==="")&&i.push(o);return{missingFields:i,error:r}}};var To={strings:{addBulkFilesFailed:{0:"Failed to add %{smart_count} file due to an internal error",1:"Failed to add %{smart_count} files due to internal errors"},youCanOnlyUploadX:{0:"You can only upload %{smart_count} file",1:"You can only upload %{smart_count} files"},youHaveToAtLeastSelectX:{0:"You have to select at least %{smart_count} file",1:"You have to select at least %{smart_count} files"},exceedsSize:"%{file} exceeds maximum allowed size of %{size}",missingRequiredMetaField:"Missing required meta fields",missingRequiredMetaFieldOnFile:"Missing required meta fields in %{fileName}",inferiorSize:"This file is smaller than the allowed size of %{size}",youCanOnlyUploadFileTypes:"You can only upload: %{types}",noMoreFilesAllowed:"Cannot add more files",noDuplicates:"Cannot add the duplicate file '%{fileName}', it already exists",companionError:"Connection with Companion failed",authAborted:"Authentication aborted",companionUnauthorizeHint:"To unauthorize to your %{provider} account, please go to %{url}",failedToUpload:"Failed to upload %{file}",noInternetConnection:"No Internet connection",connectedToInternet:"Connected to the Internet",noFilesFound:"You have no files or folders here",noSearchResults:"Unfortunately, there are no results for this search",selectX:{0:"Select %{smart_count}",1:"Select %{smart_count}"},allFilesFromFolderNamed:"All files from folder %{name}",openFolderNamed:"Open folder %{name}",cancel:"Cancel",logOut:"Log out",filter:"Filter",resetFilter:"Reset filter",loading:"Loading...",loadedXFiles:"Loaded %{numFiles} files",authenticateWithTitle:"Please authenticate with %{pluginName} to select files",authenticateWith:"Connect to %{pluginName}",signInWithGoogle:"Sign in with Google",searchImages:"Search for images",enterTextToSearch:"Enter text to search for images",search:"Search",resetSearch:"Reset search",emptyFolderAdded:"No files were added from empty folder",addedNumFiles:"Added %{numFiles} file(s)",folderAlreadyAdded:'The folder "%{folder}" was already added',folderAdded:{0:"Added %{smart_count} file from %{folder}",1:"Added %{smart_count} files from %{folder}"},additionalRestrictionsFailed:"%{count} additional restrictions were not fulfilled"}};var Fo,Eo;function g(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var il=0;function M(t){return"__private_"+il+++"_"+t}var ol={version:"3.10.1"},Cr={totalProgress:0,allowNewUpload:!0,error:null,recoveredState:null},z=M("plugins"),se=M("restricter"),kt=M("storeUnsubscribe"),Pe=M("emitter"),Ke=M("preProcessors"),Ge=M("uploaders"),Ee=M("postProcessors"),ie=M("informAndEmit"),Lt=M("checkRequiredMetaFieldsOnFile"),_s=M("checkRequiredMetaFields"),$t=M("assertNewUploadAllowed"),Ss=M("transformFile"),jt=M("startIfAutoProceed"),Mt=M("checkAndUpdateFileState"),bs=M("addListeners"),ge=M("updateOnlineStatus"),Nt=M("requestClientById"),Te=M("createUpload"),ws=M("getUpload"),Xe=M("removeUpload"),Fe=M("runUpload");Fo=Symbol.for("uppy test: getPlugins");Eo=Symbol.for("uppy test: createUpload");var Rr=class t{constructor(e){Object.defineProperty(this,Fe,{value:yl}),Object.defineProperty(this,Xe,{value:gl}),Object.defineProperty(this,ws,{value:ml}),Object.defineProperty(this,Te,{value:fl}),Object.defineProperty(this,bs,{value:hl}),Object.defineProperty(this,Mt,{value:cl}),Object.defineProperty(this,jt,{value:pl}),Object.defineProperty(this,Ss,{value:dl}),Object.defineProperty(this,$t,{value:ul}),Object.defineProperty(this,_s,{value:ll}),Object.defineProperty(this,Lt,{value:al}),Object.defineProperty(this,ie,{value:nl}),Object.defineProperty(this,z,{writable:!0,value:Object.create(null)}),Object.defineProperty(this,se,{writable:!0,value:void 0}),Object.defineProperty(this,kt,{writable:!0,value:void 0}),Object.defineProperty(this,Pe,{writable:!0,value:(0,Uo.default)()}),Object.defineProperty(this,Ke,{writable:!0,value:new Set}),Object.defineProperty(this,Ge,{writable:!0,value:new Set}),Object.defineProperty(this,Ee,{writable:!0,value:new Set}),this.scheduledAutoProceed=null,this.wasOffline=!1,this.calculateProgress=(0,Oo.default)((i,o)=>{let n=this.getFile(i?.id);if(i==null||!n){this.log(`Not setting progress for a file that has been removed: ${i?.id}`);return}if(n.progress.percentage===100){this.log(`Not setting progress for a file that has been already uploaded: ${i.id}`);return}let a=Number.isFinite(o.bytesTotal)&&o.bytesTotal>0;this.setFileState(i.id,{progress:{...n.progress,bytesUploaded:o.bytesUploaded,bytesTotal:o.bytesTotal,percentage:a?Math.round(o.bytesUploaded/o.bytesTotal*100):0}}),this.calculateTotalProgress()},500,{leading:!0,trailing:!0}),Object.defineProperty(this,ge,{writable:!0,value:this.updateOnlineStatus.bind(this)}),Object.defineProperty(this,Nt,{writable:!0,value:new Map}),this.defaultLocale=To;let r={id:"uppy",autoProceed:!1,allowMultipleUploadBatches:!0,debug:!1,restrictions:Po,meta:{},onBeforeFileAdded:(i,o)=>!Object.hasOwn(o,i.id),onBeforeUpload:i=>i,store:new uo,logger:fo,infoTimeout:5e3},s={...r,...e};this.opts={...s,restrictions:{...r.restrictions,...e&&e.restrictions}},e&&e.logger&&e.debug?this.log("You are using a custom `logger`, but also set `debug: true`, which uses built-in logger to output logs to console. Ignoring `debug: true` and using your custom `logger`.","warning"):e&&e.debug&&(this.opts.logger=mo),this.log(`Using Core v${t.VERSION}`),this.i18nInit(),this.store=this.opts.store,this.setState({...Cr,plugins:{},files:{},currentUploads:{},capabilities:{uploadProgress:ms(),individualCancellation:!0,resumableUploads:!1},meta:{...this.opts.meta},info:[]}),g(this,se)[se]=new Ar(()=>this.opts,this.i18n),g(this,kt)[kt]=this.store.subscribe((i,o,n)=>{this.emit("state-update",i,o,n),this.updateAll(o)}),this.opts.debug&&typeof window<"u"&&(window[this.opts.id]=this),g(this,bs)[bs]()}emit(e){for(var r=arguments.length,s=new Array(r>1?r-1:0),i=1;i<r;i++)s[i-1]=arguments[i];g(this,Pe)[Pe].emit(e,...s)}on(e,r){return g(this,Pe)[Pe].on(e,r),this}once(e,r){return g(this,Pe)[Pe].once(e,r),this}off(e,r){return g(this,Pe)[Pe].off(e,r),this}updateAll(e){this.iteratePlugins(r=>{r.update(e)})}setState(e){this.store.setState(e)}getState(){return this.store.getState()}patchFilesState(e){let r=this.getState().files;this.setState({files:{...r,...Object.fromEntries(Object.entries(e).map(s=>{let[i,o]=s;return[i,{...r[i],...o}]}))}})}setFileState(e,r){if(!this.getState().files[e])throw new Error(`Can\u2019t set state for ${e} (the file could have been removed)`);this.patchFilesState({[e]:r})}i18nInit(){let e=s=>this.log(`Missing i18n string: ${s}`,"error"),r=new He([this.defaultLocale,this.opts.locale],{onMissingKey:e});this.i18n=r.translate.bind(r),this.i18nArray=r.translateArray.bind(r),this.locale=r.locale}setOptions(e){this.opts={...this.opts,...e,restrictions:{...this.opts.restrictions,...e?.restrictions}},e.meta&&this.setMeta(e.meta),this.i18nInit(),e.locale&&this.iteratePlugins(r=>{r.setOptions(e)}),this.setState(void 0)}resetProgress(){let e={percentage:0,bytesUploaded:0,uploadComplete:!1,uploadStarted:null},r={...this.getState().files},s={};Object.keys(r).forEach(i=>{s[i]={...r[i],progress:{...r[i].progress,...e}}}),this.setState({files:s,...Cr}),this.emit("reset-progress")}clearUploadedFiles(){this.setState({...Cr,files:{}})}addPreProcessor(e){g(this,Ke)[Ke].add(e)}removePreProcessor(e){return g(this,Ke)[Ke].delete(e)}addPostProcessor(e){g(this,Ee)[Ee].add(e)}removePostProcessor(e){return g(this,Ee)[Ee].delete(e)}addUploader(e){g(this,Ge)[Ge].add(e)}removeUploader(e){return g(this,Ge)[Ge].delete(e)}setMeta(e){let r={...this.getState().meta,...e},s={...this.getState().files};Object.keys(s).forEach(i=>{s[i]={...s[i],meta:{...s[i].meta,...e}}}),this.log("Adding metadata:"),this.log(e),this.setState({meta:r,files:s})}setFileMeta(e,r){let s={...this.getState().files};if(!s[e]){this.log("Was trying to set metadata for a file that has been removed: ",e);return}let i={...s[e].meta,...r};s[e]={...s[e],meta:i},this.setState({files:s})}getFile(e){return this.getState().files[e]}getFiles(){let{files:e}=this.getState();return Object.values(e)}getFilesByIds(e){return e.map(r=>this.getFile(r))}getObjectOfFilesPerState(){let{files:e,totalProgress:r,error:s}=this.getState(),i=Object.values(e),o=i.filter(f=>{let{progress:b}=f;return!b.uploadComplete&&b.uploadStarted}),n=i.filter(f=>!f.progress.uploadStarted),a=i.filter(f=>f.progress.uploadStarted||f.progress.preprocess||f.progress.postprocess),l=i.filter(f=>f.progress.uploadStarted),d=i.filter(f=>f.isPaused),p=i.filter(f=>f.progress.uploadComplete),u=i.filter(f=>f.error),h=o.filter(f=>!f.isPaused),c=i.filter(f=>f.progress.preprocess||f.progress.postprocess);return{newFiles:n,startedFiles:a,uploadStartedFiles:l,pausedFiles:d,completeFiles:p,erroredFiles:u,inProgressFiles:o,inProgressNotPausedFiles:h,processingFiles:c,isUploadStarted:l.length>0,isAllComplete:r===100&&p.length===i.length&&c.length===0,isAllErrored:!!s&&u.length===i.length,isAllPaused:o.length!==0&&d.length===o.length,isUploadInProgress:o.length>0,isSomeGhost:i.some(f=>f.isGhost)}}validateRestrictions(e,r){r===void 0&&(r=this.getFiles());try{g(this,se)[se].validate(r,[e])}catch(s){return s}return null}checkIfFileAlreadyExists(e){let{files:r}=this.getState();return!!(r[e]&&!r[e].isGhost)}addFile(e){g(this,$t)[$t](e);let{nextFilesState:r,validFilesToAdd:s,errors:i}=g(this,Mt)[Mt]([e]),o=i.filter(a=>a.isRestriction);if(g(this,ie)[ie](o),i.length>0)throw i[0];this.setState({files:r});let[n]=s;return this.emit("file-added",n),this.emit("files-added",s),this.log(`Added file: ${n.name}, ${n.id}, mime type: ${n.type}`),g(this,jt)[jt](),n.id}addFiles(e){g(this,$t)[$t]();let{nextFilesState:r,validFilesToAdd:s,errors:i}=g(this,Mt)[Mt](e),o=i.filter(a=>a.isRestriction);g(this,ie)[ie](o);let n=i.filter(a=>!a.isRestriction);if(n.length>0){let a=`Multiple errors occurred while adding files:
`;if(n.forEach(l=>{a+=`
 * ${l.message}`}),this.info({message:this.i18n("addBulkFilesFailed",{smart_count:n.length}),details:a},"error",this.opts.infoTimeout),typeof AggregateError=="function")throw new AggregateError(n,a);{let l=new Error(a);throw l.errors=n,l}}this.setState({files:r}),s.forEach(a=>{this.emit("file-added",a)}),this.emit("files-added",s),s.length>5?this.log(`Added batch of ${s.length} files`):Object.values(s).forEach(a=>{this.log(`Added file: ${a.name}
 id: ${a.id}
 type: ${a.type}`)}),s.length>0&&g(this,jt)[jt]()}removeFiles(e,r){let{files:s,currentUploads:i}=this.getState(),o={...s},n={...i},a=Object.create(null);e.forEach(u=>{s[u]&&(a[u]=s[u],delete o[u])});function l(u){return a[u]===void 0}Object.keys(n).forEach(u=>{let h=i[u].fileIDs.filter(l);if(h.length===0){delete n[u];return}let{capabilities:c}=this.getState();if(h.length!==i[u].fileIDs.length&&!c.individualCancellation)throw new Error("individualCancellation is disabled");n[u]={...i[u],fileIDs:h}});let d={currentUploads:n,files:o};Object.keys(o).length===0&&(d.allowNewUpload=!0,d.error=null,d.recoveredState=null),this.setState(d),this.calculateTotalProgress();let p=Object.keys(a);p.forEach(u=>{this.emit("file-removed",a[u],r)}),p.length>5?this.log(`Removed ${p.length} files`):this.log(`Removed files: ${p.join(", ")}`)}removeFile(e,r){this.removeFiles([e],r)}pauseResume(e){if(!this.getState().capabilities.resumableUploads||this.getFile(e).progress.uploadComplete)return;let s=!(this.getFile(e).isPaused||!1);return this.setFileState(e,{isPaused:s}),this.emit("upload-pause",e,s),s}pauseAll(){let e={...this.getState().files};Object.keys(e).filter(s=>!e[s].progress.uploadComplete&&e[s].progress.uploadStarted).forEach(s=>{let i={...e[s],isPaused:!0};e[s]=i}),this.setState({files:e}),this.emit("pause-all")}resumeAll(){let e={...this.getState().files};Object.keys(e).filter(s=>!e[s].progress.uploadComplete&&e[s].progress.uploadStarted).forEach(s=>{let i={...e[s],isPaused:!1,error:null};e[s]=i}),this.setState({files:e}),this.emit("resume-all")}retryAll(){let e={...this.getState().files},r=Object.keys(e).filter(i=>e[i].error);if(r.forEach(i=>{let o={...e[i],isPaused:!1,error:null};e[i]=o}),this.setState({files:e,error:null}),this.emit("retry-all",r),r.length===0)return Promise.resolve({successful:[],failed:[]});let s=g(this,Te)[Te](r,{forceAllowNewUpload:!0});return g(this,Fe)[Fe](s)}cancelAll(e){let{reason:r="user"}=e===void 0?{}:e;if(this.emit("cancel-all",{reason:r}),r==="user"){let{files:s}=this.getState(),i=Object.keys(s);i.length&&this.removeFiles(i,"cancel-all"),this.setState(Cr)}}retryUpload(e){this.setFileState(e,{error:null,isPaused:!1}),this.emit("upload-retry",e);let r=g(this,Te)[Te]([e],{forceAllowNewUpload:!0});return g(this,Fe)[Fe](r)}logout(){this.iteratePlugins(e=>{var r;(r=e.provider)==null||r.logout==null||r.logout()})}calculateTotalProgress(){let r=this.getFiles().filter(d=>d.progress.uploadStarted||d.progress.preprocess||d.progress.postprocess);if(r.length===0){this.emit("progress",0),this.setState({totalProgress:0});return}let s=r.filter(d=>d.progress.bytesTotal!=null),i=r.filter(d=>d.progress.bytesTotal==null);if(s.length===0){let d=r.length*100,p=i.reduce((h,c)=>h+c.progress.percentage,0),u=Math.round(p/d*100);this.setState({totalProgress:u});return}let o=s.reduce((d,p)=>{var u;return d+((u=p.progress.bytesTotal)!=null?u:0)},0),n=o/s.length;o+=n*i.length;let a=0;s.forEach(d=>{a+=d.progress.bytesUploaded}),i.forEach(d=>{a+=n*(d.progress.percentage||0)/100});let l=o===0?0:Math.round(a/o*100);l>100&&(l=100),this.setState({totalProgress:l}),this.emit("progress",l)}updateOnlineStatus(){var e;((e=window.navigator.onLine)!=null?e:!0)?(this.emit("is-online"),this.wasOffline&&(this.emit("back-online"),this.info(this.i18n("connectedToInternet"),"success",3e3),this.wasOffline=!1)):(this.emit("is-offline"),this.info(this.i18n("noInternetConnection"),"error",0),this.wasOffline=!0)}getID(){return this.opts.id}use(e,r){if(typeof e!="function"){let n=`Expected a plugin class, but got ${e===null?"null":typeof e}. Please verify that the plugin was imported and spelled correctly.`;throw new TypeError(n)}let s=new e(this,r),i=s.id;if(!i)throw new Error("Your plugin must have an id");if(!s.type)throw new Error("Your plugin must have a type");let o=this.getPlugin(i);if(o){let n=`Already found a plugin named '${o.id}'. Tried to use: '${i}'.
Uppy plugins must have unique \`id\` options. See https://uppy.io/docs/plugins/#id.`;throw new Error(n)}return e.VERSION&&this.log(`Using ${i} v${e.VERSION}`),s.type in g(this,z)[z]?g(this,z)[z][s.type].push(s):g(this,z)[z][s.type]=[s],s.install(),this.emit("plugin-added",s),this}getPlugin(e){for(let r of Object.values(g(this,z)[z])){let s=r.find(i=>i.id===e);if(s!=null)return s}}[Fo](e){return g(this,z)[z][e]}iteratePlugins(e){Object.values(g(this,z)[z]).flat(1).forEach(e)}removePlugin(e){this.log(`Removing plugin ${e.id}`),this.emit("plugin-remove",e),e.uninstall&&e.uninstall();let r=g(this,z)[z][e.type],s=r.findIndex(n=>n.id===e.id);s!==-1&&r.splice(s,1);let o={plugins:{...this.getState().plugins,[e.id]:void 0}};this.setState(o)}close(e){let{reason:r}=e===void 0?{}:e;this.log(`Closing Uppy instance ${this.opts.id}: removing all files and uninstalling plugins`),this.cancelAll({reason:r}),g(this,kt)[kt](),this.iteratePlugins(s=>{this.removePlugin(s)}),typeof window<"u"&&window.removeEventListener&&(window.removeEventListener("online",g(this,ge)[ge]),window.removeEventListener("offline",g(this,ge)[ge]))}hideInfo(){let{info:e}=this.getState();this.setState({info:e.slice(1)}),this.emit("info-hidden")}info(e,r,s){r===void 0&&(r="info"),s===void 0&&(s=3e3);let i=typeof e=="object";this.setState({info:[...this.getState().info,{type:r,message:i?e.message:e,details:i?e.details:null}]}),setTimeout(()=>this.hideInfo(),s),this.emit("info-visible")}log(e,r){let{logger:s}=this.opts;switch(r){case"error":s.error(e);break;case"warning":s.warn(e);break;default:s.debug(e);break}}registerRequestClient(e,r){g(this,Nt)[Nt].set(e,r)}getRequestClientForFile(e){if(!e.remote)throw new Error(`Tried to get RequestClient for a non-remote file ${e.id}`);let r=g(this,Nt)[Nt].get(e.remote.requestClientId);if(r==null)throw new Error(`requestClientId "${e.remote.requestClientId}" not registered for file "${e.id}"`);return r}restore(e){return this.log(`Core: attempting to restore upload "${e}"`),this.getState().currentUploads[e]?g(this,Fe)[Fe](e):(g(this,Xe)[Xe](e),Promise.reject(new Error("Nonexistent upload")))}[Eo](){return g(this,Te)[Te](...arguments)}addResultData(e,r){if(!g(this,ws)[ws](e)){this.log(`Not setting result for an upload that has been removed: ${e}`);return}let{currentUploads:s}=this.getState(),i={...s[e],result:{...s[e].result,...r}};this.setState({currentUploads:{...s,[e]:i}})}upload(){var e;(e=g(this,z)[z].uploader)!=null&&e.length||this.log("No uploader type plugins are used","warning");let{files:r}=this.getState(),s=this.opts.onBeforeUpload(r);return s===!1?Promise.reject(new Error("Not starting the upload because onBeforeUpload returned false")):(s&&typeof s=="object"&&(r=s,this.setState({files:r})),Promise.resolve().then(()=>g(this,se)[se].validateMinNumberOfFiles(r)).catch(i=>{throw g(this,ie)[ie]([i]),i}).then(()=>{if(!g(this,_s)[_s](r))throw new te(this.i18n("missingRequiredMetaField"))}).catch(i=>{throw i}).then(()=>{let{currentUploads:i}=this.getState(),o=Object.values(i).flatMap(l=>l.fileIDs),n=[];Object.keys(r).forEach(l=>{let d=this.getFile(l);!d.progress.uploadStarted&&o.indexOf(l)===-1&&n.push(d.id)});let a=g(this,Te)[Te](n);return g(this,Fe)[Fe](a)}).catch(i=>{throw this.emit("error",i),this.log(i,"error"),i}))}};function nl(t){for(let o of t)o.isRestriction?this.emit("restriction-failed",o.file,o):this.emit("error",o,o.file),this.log(o,"warning");let e=t.filter(o=>o.isUserFacing),r=4,s=e.slice(0,r),i=e.slice(r);s.forEach(o=>{let{message:n,details:a=""}=o;this.info({message:n,details:a},"error",this.opts.infoTimeout)}),i.length>0&&this.info({message:this.i18n("additionalRestrictionsFailed",{count:i.length})})}function al(t){let{missingFields:e,error:r}=g(this,se)[se].getMissingRequiredMetaFields(t);return e.length>0?(this.setFileState(t.id,{missingRequiredMetaFields:e}),this.log(r.message),this.emit("restriction-failed",t,r),!1):!0}function ll(t){let e=!0;for(let r of Object.values(t))g(this,Lt)[Lt](r)||(e=!1);return e}function ul(t){let{allowNewUpload:e}=this.getState();if(e===!1){let r=new te(this.i18n("noMoreFilesAllowed"),{file:t});throw g(this,ie)[ie]([r]),r}}function dl(t){let e=t instanceof File?{name:t.name,type:t.type,size:t.size,data:t}:t,r=Rt(e),s=gs(r,e),i=Ct(s).extension,o=ho(e),n=e.meta||{};n.name=s,n.type=r;let a=Number.isFinite(e.data.size)?e.data.size:null;return{source:e.source||"",id:o,name:s,extension:i||"",meta:{...this.getState().meta,...n},type:r,data:e.data,progress:{percentage:0,bytesUploaded:0,bytesTotal:a,uploadComplete:!1,uploadStarted:null},size:a,isGhost:!1,isRemote:e.isRemote||!1,remote:e.remote||"",preview:e.preview}}function pl(){this.opts.autoProceed&&!this.scheduledAutoProceed&&(this.scheduledAutoProceed=setTimeout(()=>{this.scheduledAutoProceed=null,this.upload().catch(t=>{t.isRestriction||this.log(t.stack||t.message||t)})},4))}function cl(t){let{files:e}=this.getState(),r={...e},s=[],i=[];for(let n of t)try{var o;let a=g(this,Ss)[Ss](n),l=(o=e[a.id])==null?void 0:o.isGhost;l&&(a={...e[a.id],isGhost:!1,data:n.data},this.log(`Replaced the blob in the restored ghost file: ${a.name}, ${a.id}`));let d=this.opts.onBeforeFileAdded(a,r);if(!d&&this.checkIfFileAlreadyExists(a.id))throw new te(this.i18n("noDuplicates",{fileName:a.name}),{file:n});if(d===!1&&!l)throw new te("Cannot add the file because onBeforeFileAdded returned false.",{isUserFacing:!1,file:n});typeof d=="object"&&d!==null&&(a=d),g(this,se)[se].validateSingleFile(a),r[a.id]=a,s.push(a)}catch(a){i.push(a)}try{g(this,se)[se].validateAggregateRestrictions(Object.values(e),s)}catch(n){return i.push(n),{nextFilesState:e,validFilesToAdd:[],errors:i}}return{nextFilesState:r,validFilesToAdd:s,errors:i}}function hl(){let t=(s,i,o)=>{let n=s.message||"Unknown error";s.details&&(n+=` ${s.details}`),this.setState({error:n}),i!=null&&i.id in this.getState().files&&this.setFileState(i.id,{error:n,response:o})};this.on("error",t),this.on("upload-error",(s,i,o)=>{if(t(i,s,o),typeof i=="object"&&i.message){var n;this.log(i.message,"error");let a=new Error(this.i18n("failedToUpload",{file:(n=s?.name)!=null?n:""}));a.isUserFacing=!0,a.details=i.message,i.details&&(a.details+=` ${i.details}`),g(this,ie)[ie]([a])}else g(this,ie)[ie]([i])});let e=null;this.on("upload-stalled",(s,i)=>{let{message:o}=s,n=i.map(a=>a.meta.name).join(", ");e||(this.info({message:o,details:n},"warning",this.opts.infoTimeout),e=setTimeout(()=>{e=null},this.opts.infoTimeout)),this.log(`${o} ${n}`.trim(),"warning")}),this.on("upload",()=>{this.setState({error:null})});let r=s=>{let i=s.filter(n=>{let a=n!=null&&this.getFile(n.id);return a||this.log(`Not setting progress for a file that has been removed: ${n?.id}`),a}),o=Object.fromEntries(i.map(n=>[n.id,{progress:{uploadStarted:Date.now(),uploadComplete:!1,percentage:0,bytesUploaded:0,bytesTotal:n.size}}]));this.patchFilesState(o)};this.on("upload-start",s=>{s.forEach(i=>{this.emit("upload-started",i)}),r(s)}),this.on("upload-progress",this.calculateProgress),this.on("upload-success",(s,i)=>{if(s==null||!this.getFile(s.id)){this.log(`Not setting progress for a file that has been removed: ${s?.id}`);return}let o=this.getFile(s.id).progress;this.setFileState(s.id,{progress:{...o,postprocess:g(this,Ee)[Ee].size>0?{mode:"indeterminate"}:void 0,uploadComplete:!0,percentage:100,bytesUploaded:o.bytesTotal},response:i,uploadURL:i.uploadURL,isPaused:!1}),s.size==null&&this.setFileState(s.id,{size:i.bytesUploaded||o.bytesTotal}),this.calculateTotalProgress()}),this.on("preprocess-progress",(s,i)=>{if(s==null||!this.getFile(s.id)){this.log(`Not setting progress for a file that has been removed: ${s?.id}`);return}this.setFileState(s.id,{progress:{...this.getFile(s.id).progress,preprocess:i}})}),this.on("preprocess-complete",s=>{if(s==null||!this.getFile(s.id)){this.log(`Not setting progress for a file that has been removed: ${s?.id}`);return}let i={...this.getState().files};i[s.id]={...i[s.id],progress:{...i[s.id].progress}},delete i[s.id].progress.preprocess,this.setState({files:i})}),this.on("postprocess-progress",(s,i)=>{if(s==null||!this.getFile(s.id)){this.log(`Not setting progress for a file that has been removed: ${s?.id}`);return}this.setFileState(s.id,{progress:{...this.getState().files[s.id].progress,postprocess:i}})}),this.on("postprocess-complete",s=>{if(s==null||!this.getFile(s.id)){this.log(`Not setting progress for a file that has been removed: ${s?.id}`);return}let i={...this.getState().files};i[s.id]={...i[s.id],progress:{...i[s.id].progress}},delete i[s.id].progress.postprocess,this.setState({files:i})}),this.on("restored",()=>{this.calculateTotalProgress()}),this.on("dashboard:file-edit-complete",s=>{s&&g(this,Lt)[Lt](s)}),typeof window<"u"&&window.addEventListener&&(window.addEventListener("online",g(this,ge)[ge]),window.addEventListener("offline",g(this,ge)[ge]),setTimeout(g(this,ge)[ge],3e3))}function fl(t,e){e===void 0&&(e={});let{forceAllowNewUpload:r=!1}=e,{allowNewUpload:s,currentUploads:i}=this.getState();if(!s&&!r)throw new Error("Cannot create a new upload: already uploading.");let o=Fr();return this.emit("upload",{id:o,fileIDs:t}),this.setState({allowNewUpload:this.opts.allowMultipleUploadBatches!==!1&&this.opts.allowMultipleUploads!==!1,currentUploads:{...i,[o]:{fileIDs:t,step:0,result:{}}}}),o}function ml(t){let{currentUploads:e}=this.getState();return e[t]}function gl(t){let e={...this.getState().currentUploads};delete e[t],this.setState({currentUploads:e})}async function yl(t){let e=()=>{let{currentUploads:o}=this.getState();return o[t]},r=e(),s=[...g(this,Ke)[Ke],...g(this,Ge)[Ge],...g(this,Ee)[Ee]];try{for(let o=r.step||0;o<s.length&&r;o++){let n=s[o];this.setState({currentUploads:{...this.getState().currentUploads,[t]:{...r,step:o}}});let{fileIDs:a}=r;await n(a,t),r=e()}}catch(o){throw g(this,Xe)[Xe](t),o}if(r){r.fileIDs.forEach(l=>{let d=this.getFile(l);d&&d.progress.postprocess&&this.emit("postprocess-complete",d)});let o=r.fileIDs.map(l=>this.getFile(l)),n=o.filter(l=>!l.error),a=o.filter(l=>l.error);this.addResultData(t,{successful:n,failed:a,uploadID:t}),r=e()}let i;return r&&(i=r.result,this.emit("complete",i),g(this,Xe)[Xe](t)),i==null&&this.log(`Not setting result for an upload that has been removed: ${t}`),i}Rr.VERSION=ol.version;var kr=Rr;var Lr,$,ko,vl,Ve,xo,$o,Ps,Us,Ts,Fs,_l,Bt={},jo=[],bl=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Os=Array.isArray;function Be(t,e){for(var r in e)t[r]=e[r];return t}function Mo(t){var e=t.parentNode;e&&e.removeChild(t)}function m(t,e,r){var s,i,o,n={};for(o in e)o=="key"?s=e[o]:o=="ref"?i=e[o]:n[o]=e[o];if(arguments.length>2&&(n.children=arguments.length>3?Lr.call(arguments,2):r),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)n[o]===void 0&&(n[o]=t.defaultProps[o]);return jr(t,n,s,i,null)}function jr(t,e,r,s,i){var o={type:t,props:e,key:r,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:i??++ko,__i:-1,__u:0};return i==null&&$.vnode!=null&&$.vnode(o),o}function Br(t){return t.children}function Mr(t,e){this.props=t,this.context=e}function Je(t,e){if(e==null)return t.__?Je(t.__,t.__i+1):null;for(var r;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null)return r.__e;return typeof t.type=="function"?Je(t):null}function No(t){var e,r;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((r=t.__k[e])!=null&&r.__e!=null){t.__e=t.__c.base=r.__e;break}return No(t)}}function Ao(t){(!t.__d&&(t.__d=!0)&&Ve.push(t)&&!Nr.__r++||xo!==$.debounceRendering)&&((xo=$.debounceRendering)||$o)(Nr)}function Nr(){var t,e,r,s,i,o,n,a;for(Ve.sort(Ps);t=Ve.shift();)t.__d&&(e=Ve.length,s=void 0,o=(i=(r=t).__v).__e,n=[],a=[],r.__P&&((s=Be({},i)).__v=i.__v+1,$.vnode&&$.vnode(s),xs(r.__P,s,i,r.__n,r.__P.ownerSVGElement!==void 0,32&i.__u?[o]:null,n,o??Je(i),!!(32&i.__u),a),s.__v=i.__v,s.__.__k[s.__i]=s,Io(n,s,a),s.__e!=o&&No(s)),Ve.length>e&&Ve.sort(Ps));Nr.__r=0}function Lo(t,e,r,s,i,o,n,a,l,d,p){var u,h,c,f,b,_=s&&s.__k||jo,v=e.length;for(r.__d=l,wl(r,e,_),l=r.__d,u=0;u<v;u++)(c=r.__k[u])!=null&&typeof c!="boolean"&&typeof c!="function"&&(h=c.__i===-1?Bt:_[c.__i]||Bt,c.__i=u,xs(t,c,h,i,o,n,a,l,d,p),f=c.__e,c.ref&&h.ref!=c.ref&&(h.ref&&As(h.ref,null,c),p.push(c.ref,c.__c||f,c)),b==null&&f!=null&&(b=f),65536&c.__u||h.__k===c.__k?(l&&!l.isConnected&&(l=Je(h)),l=Bo(c,l,t)):typeof c.type=="function"&&c.__d!==void 0?l=c.__d:f&&(l=f.nextSibling),c.__d=void 0,c.__u&=-196609);r.__d=l,r.__e=b}function wl(t,e,r){var s,i,o,n,a,l=e.length,d=r.length,p=d,u=0;for(t.__k=[],s=0;s<l;s++)n=s+u,(i=t.__k[s]=(i=e[s])==null||typeof i=="boolean"||typeof i=="function"?null:typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?jr(null,i,null,null,null):Os(i)?jr(Br,{children:i},null,null,null):i.constructor===void 0&&i.__b>0?jr(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i)!=null?(i.__=t,i.__b=t.__b+1,a=Sl(i,r,n,p),i.__i=a,o=null,a!==-1&&(p--,(o=r[a])&&(o.__u|=131072)),o==null||o.__v===null?(a==-1&&u--,typeof i.type!="function"&&(i.__u|=65536)):a!==n&&(a===n+1?u++:a>n?p>l-n?u+=a-n:u--:a<n?a==n-1&&(u=a-n):u=0,a!==s+u&&(i.__u|=65536))):(o=r[n])&&o.key==null&&o.__e&&!(131072&o.__u)&&(o.__e==t.__d&&(t.__d=Je(o)),Es(o,o,!1),r[n]=null,p--);if(p)for(s=0;s<d;s++)(o=r[s])!=null&&!(131072&o.__u)&&(o.__e==t.__d&&(t.__d=Je(o)),Es(o,o))}function Bo(t,e,r){var s,i;if(typeof t.type=="function"){for(s=t.__k,i=0;s&&i<s.length;i++)s[i]&&(s[i].__=t,e=Bo(s[i],e,r));return e}t.__e!=e&&(r.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType===8);return e}function Sl(t,e,r,s){var i=t.key,o=t.type,n=r-1,a=r+1,l=e[r];if(l===null||l&&i==l.key&&o===l.type&&!(131072&l.__u))return r;if(s>(l!=null&&!(131072&l.__u)?1:0))for(;n>=0||a<e.length;){if(n>=0){if((l=e[n])&&!(131072&l.__u)&&i==l.key&&o===l.type)return n;n--}if(a<e.length){if((l=e[a])&&!(131072&l.__u)&&i==l.key&&o===l.type)return a;a++}}return-1}function Co(t,e,r){e[0]==="-"?t.setProperty(e,r??""):t[e]=r==null?"":typeof r!="number"||bl.test(e)?r:r+"px"}function $r(t,e,r,s,i){var o;e:if(e==="style")if(typeof r=="string")t.style.cssText=r;else{if(typeof s=="string"&&(t.style.cssText=s=""),s)for(e in s)r&&e in r||Co(t.style,e,"");if(r)for(e in r)s&&r[e]===s[e]||Co(t.style,e,r[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/(PointerCapture)$|Capture$/i,"$1")),e=e.toLowerCase()in t||e==="onFocusOut"||e==="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=r,r?s?r.u=s.u:(r.u=Us,t.addEventListener(e,o?Fs:Ts,o)):t.removeEventListener(e,o?Fs:Ts,o);else{if(i)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e in t)try{t[e]=r??"";break e}catch{}typeof r=="function"||(r==null||r===!1&&e[4]!=="-"?t.removeAttribute(e):t.setAttribute(e,r))}}function Ro(t){return function(e){if(this.l){var r=this.l[e.type+t];if(e.t==null)e.t=Us++;else if(e.t<r.u)return;return r($.event?$.event(e):e)}}}function xs(t,e,r,s,i,o,n,a,l,d){var p,u,h,c,f,b,_,v,F,x,A,k,E,P,U,O=e.type;if(e.constructor!==void 0)return null;128&r.__u&&(l=!!(32&r.__u),o=[a=e.__e=r.__e]),(p=$.__b)&&p(e);e:if(typeof O=="function")try{if(v=e.props,F=(p=O.contextType)&&s[p.__c],x=p?F?F.props.value:p.__:s,r.__c?_=(u=e.__c=r.__c).__=u.__E:("prototype"in O&&O.prototype.render?e.__c=u=new O(v,x):(e.__c=u=new Mr(v,x),u.constructor=O,u.render=Tl),F&&F.sub(u),u.props=v,u.state||(u.state={}),u.context=x,u.__n=s,h=u.__d=!0,u.__h=[],u._sb=[]),u.__s==null&&(u.__s=u.state),O.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=Be({},u.__s)),Be(u.__s,O.getDerivedStateFromProps(v,u.__s))),c=u.props,f=u.state,u.__v=e,h)O.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(O.getDerivedStateFromProps==null&&v!==c&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(v,x),!u.__e&&(u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(v,u.__s,x)===!1||e.__v===r.__v)){for(e.__v!==r.__v&&(u.props=v,u.state=u.__s,u.__d=!1),e.__e=r.__e,e.__k=r.__k,e.__k.forEach(function(ee){ee&&(ee.__=e)}),A=0;A<u._sb.length;A++)u.__h.push(u._sb[A]);u._sb=[],u.__h.length&&n.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(v,u.__s,x),u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(c,f,b)})}if(u.context=x,u.props=v,u.__P=t,u.__e=!1,k=$.__r,E=0,"prototype"in O&&O.prototype.render){for(u.state=u.__s,u.__d=!1,k&&k(e),p=u.render(u.props,u.state,u.context),P=0;P<u._sb.length;P++)u.__h.push(u._sb[P]);u._sb=[]}else do u.__d=!1,k&&k(e),p=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++E<25);u.state=u.__s,u.getChildContext!=null&&(s=Be(Be({},s),u.getChildContext())),h||u.getSnapshotBeforeUpdate==null||(b=u.getSnapshotBeforeUpdate(c,f)),Lo(t,Os(U=p!=null&&p.type===Br&&p.key==null?p.props.children:p)?U:[U],e,r,s,i,o,n,a,l,d),u.base=e.__e,e.__u&=-161,u.__h.length&&n.push(u),_&&(u.__E=u.__=null)}catch(ee){e.__v=null,l||o!=null?(e.__e=a,e.__u|=l?160:32,o[o.indexOf(a)]=null):(e.__e=r.__e,e.__k=r.__k),$.__e(ee,e,r)}else o==null&&e.__v===r.__v?(e.__k=r.__k,e.__e=r.__e):e.__e=Pl(r.__e,e,r,s,i,o,n,l,d);(p=$.diffed)&&p(e)}function Io(t,e,r){e.__d=void 0;for(var s=0;s<r.length;s++)As(r[s],r[++s],r[++s]);$.__c&&$.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(o){o.call(i)})}catch(o){$.__e(o,i.__v)}})}function Pl(t,e,r,s,i,o,n,a,l){var d,p,u,h,c,f,b,_=r.props,v=e.props,F=e.type;if(F==="svg"&&(i=!0),o!=null){for(d=0;d<o.length;d++)if((c=o[d])&&"setAttribute"in c==!!F&&(F?c.localName===F:c.nodeType===3)){t=c,o[d]=null;break}}if(t==null){if(F===null)return document.createTextNode(v);t=i?document.createElementNS("http://www.w3.org/2000/svg",F):document.createElement(F,v.is&&v),o=null,a=!1}if(F===null)_===v||a&&t.data===v||(t.data=v);else{if(o=o&&Lr.call(t.childNodes),_=r.props||Bt,!a&&o!=null)for(_={},d=0;d<t.attributes.length;d++)_[(c=t.attributes[d]).name]=c.value;for(d in _)c=_[d],d=="children"||(d=="dangerouslySetInnerHTML"?u=c:d==="key"||d in v||$r(t,d,null,c,i));for(d in v)c=v[d],d=="children"?h=c:d=="dangerouslySetInnerHTML"?p=c:d=="value"?f=c:d=="checked"?b=c:d==="key"||a&&typeof c!="function"||_[d]===c||$r(t,d,c,_[d],i);if(p)a||u&&(p.__html===u.__html||p.__html===t.innerHTML)||(t.innerHTML=p.__html),e.__k=[];else if(u&&(t.innerHTML=""),Lo(t,Os(h)?h:[h],e,r,s,i&&F!=="foreignObject",o,n,o?o[0]:r.__k&&Je(r,0),a,l),o!=null)for(d=o.length;d--;)o[d]!=null&&Mo(o[d]);a||(d="value",f!==void 0&&(f!==t[d]||F==="progress"&&!f||F==="option"&&f!==_[d])&&$r(t,d,f,_[d],!1),d="checked",b!==void 0&&b!==t[d]&&$r(t,d,b,_[d],!1))}return t}function As(t,e,r){try{typeof t=="function"?t(e):t.current=e}catch(s){$.__e(s,r)}}function Es(t,e,r){var s,i;if($.unmount&&$.unmount(t),(s=t.ref)&&(s.current&&s.current!==t.__e||As(s,null,e)),(s=t.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(o){$.__e(o,e)}s.base=s.__P=null}if(s=t.__k)for(i=0;i<s.length;i++)s[i]&&Es(s[i],e,r||typeof t.type!="function");r||t.__e==null||Mo(t.__e),t.__c=t.__=t.__e=t.__d=void 0}function Tl(t,e,r){return this.constructor(t,r)}function Cs(t,e,r){var s,i,o,n;$.__&&$.__(t,e),i=(s=typeof r=="function")?null:r&&r.__k||e.__k,o=[],n=[],xs(e,t=(!s&&r||e).__k=m(Br,null,[t]),i||Bt,Bt,e.ownerSVGElement!==void 0,!s&&r?[r]:i?null:e.firstChild?Lr.call(e.childNodes):null,o,!s&&r?r:i?i.__e:e.firstChild,s,n),Io(o,t,n)}Lr=jo.slice,$={__e:function(t,e,r,s){for(var i,o,n;e=e.__;)if((i=e.__c)&&!i.__)try{if((o=i.constructor)&&o.getDerivedStateFromError!=null&&(i.setState(o.getDerivedStateFromError(t)),n=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,s||{}),n=i.__d),n)return i.__E=i}catch(a){t=a}throw t}},ko=0,vl=function(t){return t!=null&&t.constructor==null},Mr.prototype.setState=function(t,e){var r;r=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Be({},this.state),typeof t=="function"&&(t=t(Be({},r),this.props)),t&&Be(r,t),t!=null&&this.__v&&(e&&this._sb.push(e),Ao(this))},Mr.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Ao(this))},Mr.prototype.render=Br,Ve=[],$o=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ps=function(t,e){return t.__v.__b-e.__v.__b},Nr.__r=0,Us=0,Ts=Ro(!1),Fs=Ro(!0),_l=0;function Rs(t){return typeof t!="object"||t===null||!("nodeType"in t)?!1:t.nodeType===Node.ELEMENT_NODE}function Fl(t,e){return e===void 0&&(e=document),typeof t=="string"?e.querySelector(t):Rs(t)?t:null}var qo=Fl;function El(t){for(var e;t&&!t.dir;)t=t.parentNode;return(e=t)==null?void 0:e.dir}var Ir=El;var Ue=class{constructor(e,r){this.uppy=e,this.opts=r??{}}getPluginState(){let{plugins:e}=this.uppy.getState();return e?.[this.id]||{}}setPluginState(e){let{plugins:r}=this.uppy.getState();this.uppy.setState({plugins:{...r,[this.id]:{...r[this.id],...e}}})}setOptions(e){this.opts={...this.opts,...e},this.setPluginState(void 0),this.i18nInit()}i18nInit(){let e=new He([this.defaultLocale,this.uppy.locale,this.opts.locale]);this.i18n=e.translate.bind(e),this.i18nArray=e.translateArray.bind(e),this.setPluginState(void 0)}addTarget(e){throw new Error("Extend the addTarget method to add your plugin to another plugin's target")}install(){}uninstall(){}update(e){}afterUpdate(){}};function Do(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var Ul=0;function Ol(t){return"__private_"+Ul+++"_"+t}function xl(t){let e=null,r;return function(){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];return r=i,e||(e=Promise.resolve().then(()=>(e=null,t(...r)))),e}}var It=Ol("updateUI"),ks=class t extends Ue{constructor(){super(...arguments),Object.defineProperty(this,It,{writable:!0,value:void 0})}getTargetPlugin(e){let r;if(typeof e?.addTarget=="function")r=e,r instanceof t||console.warn(new Error("The provided plugin is not an instance of UIPlugin. This is an indication of a bug with the way Uppy is bundled.",{cause:{targetPlugin:r,UIPlugin:t}}));else if(typeof e=="function"){let s=e;this.uppy.iteratePlugins(i=>{i instanceof s&&(r=i)})}return r}mount(e,r){let s=r.id,i=qo(e);if(i){this.isTargetDOMEl=!0;let a=document.createElement("div");return a.classList.add("uppy-Root"),Do(this,It)[It]=xl(l=>{this.uppy.getPlugin(this.id)&&(Cs(this.render(l),a),this.afterUpdate())}),this.uppy.log(`Installing ${s} to a DOM element '${e}'`),this.opts.replaceTargetContent&&(i.innerHTML=""),Cs(this.render(this.uppy.getState()),a),this.el=a,i.appendChild(a),a.dir=this.opts.direction||Ir(a)||"ltr",this.onMount(),this.el}let o=this.getTargetPlugin(e);if(o)return this.uppy.log(`Installing ${s} to ${o.id}`),this.parent=o,this.el=o.addTarget(r),this.onMount(),this.el;this.uppy.log(`Not installing ${s}`);let n=`Invalid target option given to ${s}.`;throw typeof e=="function"?n+=" The given target is not a Plugin class. Please check that you're not specifying a React Component instead of a plugin. If you are using @uppy/* packages directly, make sure you have only 1 version of @uppy/core installed: run `npm ls @uppy/core` on the command line and verify that all the versions match and are deduped correctly.":n+="If you meant to target an HTML element, please make sure that the element exists. Check that the <script> tag initializing Uppy is right before the closing </body> tag at the end of the page. (see https://github.com/transloadit/uppy/issues/1042)\n\nIf you meant to target a plugin, please confirm that your `import` statements or `require` calls are correct.",new Error(n)}render(e){throw new Error("Extend the render method to add your plugin to a DOM element")}update(e){if(this.el!=null){var r,s;(r=(s=Do(this,It))[It])==null||r.call(s,e)}}unmount(){if(this.isTargetDOMEl){var e;(e=this.el)==null||e.remove()}this.onUnmount()}onMount(){}onUnmount(){}},qt=ks;var qr=Array.from;function $s(){let t=document.body;return!(!("draggable"in t)||!("ondragstart"in t&&"ondrop"in t)||!("FormData"in window)||!("FileReader"in window))}function Dr(t,e,r,s){let{onSuccess:i}=s;t.readEntries(o=>{let n=[...e,...o];o.length?queueMicrotask(()=>{Dr(t,n,r,{onSuccess:i})}):i(n)},o=>{r(o),i(e)})}function zo(t,e){return t==null?t:{kind:t.isFile?"file":t.isDirectory?"directory":void 0,name:t.name,getFile(){return new Promise((r,s)=>t.file(r,s))},async*values(){let r=t.createReader();yield*await new Promise(i=>{Dr(r,[],e,{onSuccess:o=>i(o.map(n=>zo(n,e)))})})},isSameEntry:void 0}}function Ho(t,e,r){try{return r===void 0&&(r=void 0),async function*(){let s=()=>`${e}/${t.name}`;if(t.kind==="file"){let i=await t.getFile();i!=null?(i.relativePath=e?s():null,yield i):r!=null&&(yield r)}else if(t.kind==="directory")for await(let i of t.values())yield*Ho(i,e?s():t.name);else r!=null&&(yield r)}()}catch(s){return Promise.reject(s)}}async function*js(t,e){let r=await Promise.all(Array.from(t.items,async s=>{var i;let o,n=()=>typeof s.getAsEntry=="function"?s.getAsEntry():s.webkitGetAsEntry();return(i=o)!=null||(o=zo(n(),e)),{fileSystemHandle:o,lastResortFile:s.getAsFile()}}));for(let{lastResortFile:s,fileSystemHandle:i}of r)if(i!=null)try{yield*Ho(i,"",s)}catch(o){s!=null?yield s:e(o)}else s!=null&&(yield s)}function Ms(t){let e=qr(t.files);return Promise.resolve(e)}async function Ns(t,e){var r;let s=(r=e?.logDropError)!=null?r:Function.prototype;try{let i=[];for await(let o of js(t,s))i.push(o);return i}catch{return Ms(t)}}var Wo={strings:{dropHereOr:"Drop here or %{browse}",browse:"browse"}};var Al={version:"3.1.0"},Cl={inputName:"files[]",width:"100%",height:"100%"},Ie=class t extends qt{constructor(e,r){super(e,{...Cl,...r}),this.isDragDropSupported=$s(),this.addFiles=s=>{let i=s.map(o=>({source:this.id,name:o.name,type:o.type,data:o,meta:{relativePath:o.relativePath||null}}));try{this.uppy.addFiles(i)}catch(o){this.uppy.log(o)}},this.onInputChange=s=>{let i=qr(s.target.files);i.length>0&&(this.uppy.log("[DragDrop] Files selected through input"),this.addFiles(i)),s.target.value=null},this.handleDragOver=s=>{var i,o;s.preventDefault(),s.stopPropagation();let{types:n}=s.dataTransfer,a=n.some(d=>d==="Files"),{allowNewUpload:l}=this.uppy.getState();if(!a||!l){s.dataTransfer.dropEffect="none",clearTimeout(this.removeDragOverClassTimeout);return}s.dataTransfer.dropEffect="copy",clearTimeout(this.removeDragOverClassTimeout),this.setPluginState({isDraggingOver:!0}),(i=(o=this.opts).onDragOver)==null||i.call(o,s)},this.handleDragLeave=s=>{var i,o;s.preventDefault(),s.stopPropagation(),clearTimeout(this.removeDragOverClassTimeout),this.removeDragOverClassTimeout=setTimeout(()=>{this.setPluginState({isDraggingOver:!1})},50),(i=(o=this.opts).onDragLeave)==null||i.call(o,s)},this.handleDrop=async s=>{var i,o;s.preventDefault(),s.stopPropagation(),clearTimeout(this.removeDragOverClassTimeout),this.setPluginState({isDraggingOver:!1});let n=l=>{this.uppy.log(l,"error")},a=await Ns(s.dataTransfer,{logDropError:n});a.length>0&&(this.uppy.log("[DragDrop] Files dropped"),this.addFiles(a)),(i=(o=this.opts).onDrop)==null||i.call(o,s)},this.type="acquirer",this.id=this.opts.id||"DragDrop",this.title="Drag & Drop",this.defaultLocale=Wo,this.i18nInit()}renderHiddenFileInput(){let{restrictions:e}=this.uppy.opts;return m("input",{className:"uppy-DragDrop-input",type:"file",hidden:!0,ref:r=>{this.fileInputRef=r},name:this.opts.inputName,multiple:e.maxNumberOfFiles!==1,accept:e.allowedFileTypes,onChange:this.onInputChange})}static renderArrowSvg(){return m("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon uppy-DragDrop-arrow",width:"16",height:"16",viewBox:"0 0 16 16"},m("path",{d:"M11 10V0H5v10H2l6 6 6-6h-3zm0 0",fillRule:"evenodd"}))}renderLabel(){return m("div",{className:"uppy-DragDrop-label"},this.i18nArray("dropHereOr",{browse:m("span",{className:"uppy-DragDrop-browse"},this.i18n("browse"))}))}renderNote(){return m("span",{className:"uppy-DragDrop-note"},this.opts.note)}render(){let e=`uppy-u-reset
      uppy-DragDrop-container
      ${this.isDragDropSupported?"uppy-DragDrop--isDragDropSupported":""}
      ${this.getPluginState().isDraggingOver?"uppy-DragDrop--isDraggingOver":""}
    `,r={width:this.opts.width,height:this.opts.height};return m("button",{type:"button",className:e,style:r,onClick:()=>this.fileInputRef.click(),onDragOver:this.handleDragOver,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop},this.renderHiddenFileInput(),m("div",{className:"uppy-DragDrop-inner"},t.renderArrowSvg(),this.renderLabel(),this.renderNote()))}install(){let{target:e}=this.opts;this.setPluginState({isDraggingOver:!1}),e&&this.mount(e,this)}uninstall(){this.unmount()}};Ie.VERSION=Al.version;function zr(t,e,r,s){return r===0||t===e?t:s===0?e:t+(e-t)*2**(-s/r)}var oe={STATE_ERROR:"error",STATE_WAITING:"waiting",STATE_PREPROCESSING:"preprocessing",STATE_UPLOADING:"uploading",STATE_POSTPROCESSING:"postprocessing",STATE_COMPLETE:"complete"};var Ws=Se(Ls(),1);function Dt(t){let e=[],r="indeterminate",s;for(let{progress:o}of Object.values(t)){let{preprocess:n,postprocess:a}=o;s==null&&(n||a)&&({mode:r,message:s}=n||a),n?.mode==="determinate"&&e.push(n.value),a?.mode==="determinate"&&e.push(a.value)}let i=e.reduce((o,n)=>o+n/e.length,0);return{mode:r,message:s,value:i}}var Ds=Se(Ls(),1),qs=Se(vs(),1);function Bs(t){let e=Math.floor(t/3600)%24,r=Math.floor(t/60)%60,s=Math.floor(t%60);return{hours:e,minutes:r,seconds:s}}function Is(t){let e=Bs(t),r=e.hours===0?"":`${e.hours}h`,s=e.minutes===0?"":`${e.hours===0?e.minutes:` ${e.minutes.toString(10).padStart(2,"0")}`}m`,i=e.hours!==0?"":`${e.minutes===0?e.seconds:` ${e.seconds.toString(10).padStart(2,"0")}`}s`;return`${r}${s}${i}`}var Rl="\xB7",Ko=()=>` ${Rl} `;function Go(t){let{newFiles:e,isUploadStarted:r,recoveredState:s,i18n:i,uploadState:o,isSomeGhost:n,startUpload:a}=t,l=(0,Ds.default)("uppy-u-reset","uppy-c-btn","uppy-StatusBar-actionBtn","uppy-StatusBar-actionBtn--upload",{"uppy-c-btn-primary":o===oe.STATE_WAITING},{"uppy-StatusBar-actionBtn--disabled":n}),d=e&&r&&!s?i("uploadXNewFiles",{smart_count:e}):i("uploadXFiles",{smart_count:e});return m("button",{type:"button",className:l,"aria-label":i("uploadXFiles",{smart_count:e}),onClick:a,disabled:n,"data-uppy-super-focusable":!0},d)}function Xo(t){let{i18n:e,uppy:r}=t;return m("button",{type:"button",className:"uppy-u-reset uppy-c-btn uppy-StatusBar-actionBtn uppy-StatusBar-actionBtn--retry","aria-label":e("retryUpload"),onClick:()=>r.retryAll().catch(()=>{}),"data-uppy-super-focusable":!0,"data-cy":"retry"},m("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"8",height:"10",viewBox:"0 0 8 10"},m("path",{d:"M4 2.408a2.75 2.75 0 1 0 2.75 2.75.626.626 0 0 1 1.25.018v.023a4 4 0 1 1-4-4.041V.25a.25.25 0 0 1 .389-.208l2.299 1.533a.25.25 0 0 1 0 .416l-2.3 1.533A.25.25 0 0 1 4 3.316v-.908z"})),e("retry"))}function Vo(t){let{i18n:e,uppy:r}=t;return m("button",{type:"button",className:"uppy-u-reset uppy-StatusBar-actionCircleBtn",title:e("cancel"),"aria-label":e("cancel"),onClick:()=>r.cancelAll(),"data-cy":"cancel","data-uppy-super-focusable":!0},m("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"16",height:"16",viewBox:"0 0 16 16"},m("g",{fill:"none",fillRule:"evenodd"},m("circle",{fill:"#888",cx:"8",cy:"8",r:"8"}),m("path",{fill:"#FFF",d:"M9.283 8l2.567 2.567-1.283 1.283L8 9.283 5.433 11.85 4.15 10.567 6.717 8 4.15 5.433 5.433 4.15 8 6.717l2.567-2.567 1.283 1.283z"}))))}function Jo(t){let{isAllPaused:e,i18n:r,isAllComplete:s,resumableUploads:i,uppy:o}=t,n=r(e?"resume":"pause");function a(){if(!s){if(!i){o.cancelAll();return}if(e){o.resumeAll();return}o.pauseAll()}}return m("button",{title:n,"aria-label":n,className:"uppy-u-reset uppy-StatusBar-actionCircleBtn",type:"button",onClick:a,"data-cy":"togglePauseResume","data-uppy-super-focusable":!0},m("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"16",height:"16",viewBox:"0 0 16 16"},m("g",{fill:"none",fillRule:"evenodd"},m("circle",{fill:"#888",cx:"8",cy:"8",r:"8"}),m("path",{fill:"#FFF",d:e?"M6 4.25L11.5 8 6 11.75z":"M5 4.5h2v7H5v-7zm4 0h2v7H9v-7z"}))))}function Qo(t){let{i18n:e,doneButtonHandler:r}=t;return m("button",{type:"button",className:"uppy-u-reset uppy-c-btn uppy-StatusBar-actionBtn uppy-StatusBar-actionBtn--done",onClick:r,"data-uppy-super-focusable":!0},e("done"))}function Yo(){return m("svg",{className:"uppy-StatusBar-spinner","aria-hidden":"true",focusable:"false",width:"14",height:"14"},m("path",{d:"M13.983 6.547c-.12-2.509-1.64-4.893-3.939-5.936-2.48-1.127-5.488-.656-7.556 1.094C.524 3.367-.398 6.048.162 8.562c.556 2.495 2.46 4.52 4.94 5.183 2.932.784 5.61-.602 7.256-3.015-1.493 1.993-3.745 3.309-6.298 2.868-2.514-.434-4.578-2.349-5.153-4.84a6.226 6.226 0 0 1 2.98-6.778C6.34.586 9.74 1.1 11.373 3.493c.407.596.693 1.282.842 1.988.127.598.073 1.197.161 1.794.078.525.543 1.257 1.15.864.525-.341.49-1.05.456-1.592-.007-.15.02.3 0 0",fillRule:"evenodd"}))}function Zo(t){let{progress:e}=t,{value:r,mode:s,message:i}=e;return m("div",{className:"uppy-StatusBar-content"},m(Yo,null),s==="determinate"?`${Math.round(r*100)}% \xB7 `:"",i)}function kl(t){let{numUploads:e,complete:r,totalUploadedSize:s,totalSize:i,totalETA:o,i18n:n}=t,a=e>1;return m("div",{className:"uppy-StatusBar-statusSecondary"},a&&n("filesUploadedOfTotal",{complete:r,smart_count:e}),m("span",{className:"uppy-StatusBar-additionalInfo"},a&&Ko(),n("dataUploadedOfTotal",{complete:(0,qs.default)(s),total:(0,qs.default)(i)}),Ko(),n("xTimeLeft",{time:Is(o)})))}function en(t){let{i18n:e,complete:r,numUploads:s}=t;return m("div",{className:"uppy-StatusBar-statusSecondary"},e("filesUploadedOfTotal",{complete:r,smart_count:s}))}function $l(t){let{i18n:e,newFiles:r,startUpload:s}=t,i=(0,Ds.default)("uppy-u-reset","uppy-c-btn","uppy-StatusBar-actionBtn","uppy-StatusBar-actionBtn--uploadNewlyAdded");return m("div",{className:"uppy-StatusBar-statusSecondary"},m("div",{className:"uppy-StatusBar-statusSecondaryHint"},e("xMoreFilesAdded",{smart_count:r})),m("button",{type:"button",className:i,"aria-label":e("uploadXFiles",{smart_count:r}),onClick:s},e("upload")))}function tn(t){let{i18n:e,supportsUploadProgress:r,totalProgress:s,showProgressDetails:i,isUploadStarted:o,isAllComplete:n,isAllPaused:a,newFiles:l,numUploads:d,complete:p,totalUploadedSize:u,totalSize:h,totalETA:c,startUpload:f}=t,b=l&&o;if(!o||n)return null;let _=e(a?"paused":"uploading");function v(){return!a&&!b&&i?r?m(kl,{numUploads:d,complete:p,totalUploadedSize:u,totalSize:h,totalETA:c,i18n:e}):m(en,{i18n:e,complete:p,numUploads:d}):null}return m("div",{className:"uppy-StatusBar-content","aria-label":_,title:_},a?null:m(Yo,null),m("div",{className:"uppy-StatusBar-status"},m("div",{className:"uppy-StatusBar-statusPrimary"},r?`${_}: ${s}%`:_),v(),b?m($l,{i18n:e,newFiles:l,startUpload:f}):null))}function rn(t){let{i18n:e}=t;return m("div",{className:"uppy-StatusBar-content",role:"status",title:e("complete")},m("div",{className:"uppy-StatusBar-status"},m("div",{className:"uppy-StatusBar-statusPrimary"},m("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-StatusBar-statusIndicator uppy-c-icon",width:"15",height:"11",viewBox:"0 0 15 11"},m("path",{d:"M.414 5.843L1.627 4.63l3.472 3.472L13.202 0l1.212 1.213L5.1 10.528z"})),e("complete"))))}function sn(t){let{error:e,i18n:r,complete:s,numUploads:i}=t;function o(){let n=`${r("uploadFailed")} 

 ${e}`;alert(n)}return m("div",{className:"uppy-StatusBar-content",title:r("uploadFailed")},m("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-StatusBar-statusIndicator uppy-c-icon",width:"11",height:"11",viewBox:"0 0 11 11"},m("path",{d:"M4.278 5.5L0 1.222 1.222 0 5.5 4.278 9.778 0 11 1.222 6.722 5.5 11 9.778 9.778 11 5.5 6.722 1.222 11 0 9.778z"})),m("div",{className:"uppy-StatusBar-status"},m("div",{className:"uppy-StatusBar-statusPrimary"},r("uploadFailed"),m("button",{className:"uppy-u-reset uppy-StatusBar-details","aria-label":r("showErrorDetails"),"data-microtip-position":"top-right","data-microtip-size":"medium",onClick:o,type:"button"},"?")),m(en,{i18n:r,complete:s,numUploads:i})))}var{STATE_ERROR:on,STATE_WAITING:nn,STATE_PREPROCESSING:zs,STATE_UPLOADING:Wr,STATE_POSTPROCESSING:Hs,STATE_COMPLETE:Kr}=oe;function Gr(t){let{newFiles:e,allowNewUpload:r,isUploadInProgress:s,isAllPaused:i,resumableUploads:o,error:n,hideUploadButton:a,hidePauseResumeButton:l,hideCancelButton:d,hideRetryButton:p,recoveredState:u,uploadState:h,totalProgress:c,files:f,supportsUploadProgress:b,hideAfterFinish:_,isSomeGhost:v,doneButtonHandler:F,isUploadStarted:x,i18n:A,startUpload:k,uppy:E,isAllComplete:P,showProgressDetails:U,numUploads:O,complete:ee,totalSize:ns,totalETA:as,totalUploadedSize:Ut}=t;function De(){switch(h){case Hs:case zs:{let Pr=Dt(f);return Pr.mode==="determinate"?Pr.value*100:c}case on:return null;case Wr:return b?c:null;default:return c}}function wr(){switch(h){case Hs:case zs:{let{mode:Pr}=Dt(f);return Pr==="indeterminate"}case Wr:return!b;default:return!1}}function Sr(){if(u)return!1;switch(h){case nn:return a||e===0;case Kr:return _;default:return!1}}let ze=De(),vt=Sr(),we=ze??100,_t=!n&&e&&!s&&!i&&r&&!a,Dn=!d&&h!==nn&&h!==Kr,zn=o&&!l&&h===Wr,Hn=n&&!P&&!p,Wn=F&&h===Kr,Kn=(0,Ws.default)("uppy-StatusBar-progress",{"is-indeterminate":wr()}),Gn=(0,Ws.default)("uppy-StatusBar",`is-${h}`,{"has-ghosts":v});return m("div",{className:Gn,"aria-hidden":vt},m("div",{className:Kn,style:{width:`${we}%`},role:"progressbar","aria-label":`${we}%`,"aria-valuetext":`${we}%`,"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":ze}),(()=>{switch(h){case zs:case Hs:return m(Zo,{progress:Dt(f)});case Kr:return m(rn,{i18n:A});case on:return m(sn,{error:n,i18n:A,numUploads:O,complete:ee});case Wr:return m(tn,{i18n:A,supportsUploadProgress:b,totalProgress:c,showProgressDetails:U,isUploadStarted:x,isAllComplete:P,isAllPaused:i,newFiles:e,numUploads:O,complete:ee,totalUploadedSize:Ut,totalSize:ns,totalETA:as,startUpload:k});default:return null}})(),m("div",{className:"uppy-StatusBar-actions"},u||_t?m(Go,{newFiles:e,isUploadStarted:x,recoveredState:u,i18n:A,isSomeGhost:v,startUpload:k,uploadState:h}):null,Hn?m(Xo,{i18n:A,uppy:E}):null,zn?m(Jo,{isAllPaused:i,i18n:A,isAllComplete:P,resumableUploads:o,uppy:E}):null,Dn?m(Vo,{i18n:A,uppy:E}):null,Wn?m(Qo,{i18n:A,doneButtonHandler:F}):null))}Gr.defaultProps={doneButtonHandler:void 0,hideAfterFinish:!1,hideCancelButton:!1,hidePauseResumeButton:!1,hideRetryButton:!1,hideUploadButton:void 0,showProgressDetails:void 0};var an={strings:{uploading:"Uploading",complete:"Complete",uploadFailed:"Upload failed",paused:"Paused",retry:"Retry",cancel:"Cancel",pause:"Pause",resume:"Resume",done:"Done",filesUploadedOfTotal:{0:"%{complete} of %{smart_count} file uploaded",1:"%{complete} of %{smart_count} files uploaded"},dataUploadedOfTotal:"%{complete} of %{total}",xTimeLeft:"%{time} left",uploadXFiles:{0:"Upload %{smart_count} file",1:"Upload %{smart_count} files"},uploadXNewFiles:{0:"Upload +%{smart_count} file",1:"Upload +%{smart_count} files"},upload:"Upload",retryUpload:"Retry upload",xMoreFilesAdded:{0:"%{smart_count} more file added",1:"%{smart_count} more files added"},showErrorDetails:"Show error details"}};function R(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var jl=0;function wt(t){return"__private_"+jl+++"_"+t}var Ml={version:"3.3.1"},Nl=2e3,Ll=2e3;function Bl(t,e,r,s){if(t)return oe.STATE_ERROR;if(e)return oe.STATE_COMPLETE;if(r)return oe.STATE_WAITING;let i=oe.STATE_WAITING,o=Object.keys(s);for(let n=0;n<o.length;n++){let{progress:a}=s[o[n]];if(a.uploadStarted&&!a.uploadComplete)return oe.STATE_UPLOADING;a.preprocess&&(i=oe.STATE_PREPROCESSING),a.postprocess&&i!==oe.STATE_PREPROCESSING&&(i=oe.STATE_POSTPROCESSING)}return i}var Il={target:"body",hideUploadButton:!1,hideRetryButton:!1,hidePauseResumeButton:!1,hideCancelButton:!1,showProgressDetails:!1,hideAfterFinish:!0,doneButtonHandler:null},ce=wt("lastUpdateTime"),ye=wt("previousUploadedBytes"),Oe=wt("previousSpeed"),ne=wt("previousETA"),Ks=wt("computeSmoothETA"),zt=wt("onUploadStart"),qe=class extends qt{constructor(e,r){super(e,{...Il,...r}),Object.defineProperty(this,Ks,{value:ql}),Object.defineProperty(this,ce,{writable:!0,value:void 0}),Object.defineProperty(this,ye,{writable:!0,value:void 0}),Object.defineProperty(this,Oe,{writable:!0,value:void 0}),Object.defineProperty(this,ne,{writable:!0,value:void 0}),this.startUpload=()=>this.uppy.upload().catch(()=>{}),Object.defineProperty(this,zt,{writable:!0,value:()=>{let{recoveredState:s}=this.uppy.getState();if(R(this,Oe)[Oe]=null,R(this,ne)[ne]=null,s){R(this,ye)[ye]=Object.values(s.files).reduce((i,o)=>{let{progress:n}=o;return i+n.bytesUploaded},0),this.uppy.emit("restore-confirmed");return}R(this,ce)[ce]=performance.now(),R(this,ye)[ye]=0}}),this.id=this.opts.id||"StatusBar",this.title="StatusBar",this.type="progressindicator",this.defaultLocale=an,this.i18nInit(),this.render=this.render.bind(this),this.install=this.install.bind(this)}render(e){let{capabilities:r,files:s,allowNewUpload:i,totalProgress:o,error:n,recoveredState:a}=e,{newFiles:l,startedFiles:d,completeFiles:p,isUploadStarted:u,isAllComplete:h,isAllErrored:c,isAllPaused:f,isUploadInProgress:b,isSomeGhost:_}=this.uppy.getObjectOfFilesPerState(),v=a?Object.values(s):l,F=!!r.resumableUploads,x=r.uploadProgress!==!1,A=0,k=0;d.forEach(P=>{A+=P.progress.bytesTotal||0,k+=P.progress.bytesUploaded||0});let E=R(this,Ks)[Ks]({uploaded:k,total:A,remaining:A-k});return Gr({error:n,uploadState:Bl(n,h,a,e.files||{}),allowNewUpload:i,totalProgress:o,totalSize:A,totalUploadedSize:k,isAllComplete:!1,isAllPaused:f,isAllErrored:c,isUploadStarted:u,isUploadInProgress:b,isSomeGhost:_,recoveredState:a,complete:p.length,newFiles:v.length,numUploads:d.length,totalETA:E,files:s,i18n:this.i18n,uppy:this.uppy,startUpload:this.startUpload,doneButtonHandler:this.opts.doneButtonHandler,resumableUploads:F,supportsUploadProgress:x,showProgressDetails:this.opts.showProgressDetails,hideUploadButton:this.opts.hideUploadButton,hideRetryButton:this.opts.hideRetryButton,hidePauseResumeButton:this.opts.hidePauseResumeButton,hideCancelButton:this.opts.hideCancelButton,hideAfterFinish:this.opts.hideAfterFinish,isTargetDOMEl:this.isTargetDOMEl})}onMount(){let e=this.el;Ir(e)||(e.dir="ltr")}install(){let{target:e}=this.opts;e&&this.mount(e,this),this.uppy.on("upload",R(this,zt)[zt]),R(this,ce)[ce]=performance.now(),R(this,ye)[ye]=this.uppy.getFiles().reduce((r,s)=>r+s.progress.bytesUploaded,0)}uninstall(){this.unmount(),this.uppy.off("upload",R(this,zt)[zt])}};function ql(t){var e,r;if(t.total===0||t.remaining===0)return 0;(r=(e=R(this,ce))[ce])!=null||(e[ce]=performance.now());let s=performance.now()-R(this,ce)[ce];if(s===0){var i;return Math.round(((i=R(this,ne)[ne])!=null?i:0)/100)/10}let o=t.uploaded-R(this,ye)[ye];if(R(this,ye)[ye]=t.uploaded,o<=0){var n;return Math.round(((n=R(this,ne)[ne])!=null?n:0)/100)/10}let a=o/s,l=R(this,Oe)[Oe]==null?a:zr(a,R(this,Oe)[Oe],Nl,s);R(this,Oe)[Oe]=l;let d=t.remaining/l,p=Math.max(R(this,ne)[ne]-s,0),u=R(this,ne)[ne]==null?d:zr(d,p,Ll,s);return R(this,ne)[ne]=u,R(this,ce)[ce]=performance.now(),Math.round(u/100)/10}qe.VERSION=Ml.version;var Gs=class extends Error{constructor(){super(...arguments),this.name="UserFacingApiError"}},ln=Gs;var mn=Se(hn(),1);var zl=Object.prototype.toString,Hl=t=>zl.call(t)==="[object Error]",Wl=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function Xs(t){return t&&Hl(t)&&t.name==="TypeError"&&typeof t.message=="string"?t.message==="Load failed"?t.stack===void 0:Wl.has(t.message):!1}var St=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},fn=(t,e,r)=>{let s=r.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=s,t};async function Xr(t,e){return new Promise((r,s)=>{e={onFailedAttempt(){},retries:10,shouldRetry:()=>!0,...e};let i=mn.default.operation(e),o=()=>{i.stop(),s(e.signal?.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",o,{once:!0});let n=()=>{e.signal?.removeEventListener("abort",o),i.stop()};i.attempt(async a=>{try{let l=await t(a);n(),r(l)}catch(l){try{if(!(l instanceof Error))throw new TypeError(`Non-error was thrown: "${l}". You should only throw errors.`);if(l instanceof St)throw l.originalError;if(l instanceof TypeError&&!Xs(l))throw l;if(fn(l,a,e),await e.shouldRetry(l)||(i.stop(),s(l)),await e.onFailedAttempt(l),!i.retry(l))throw i.mainError()}catch(d){fn(d,a,e),n(),s(d)}}})})}var Vs=class extends Error{constructor(e,r){r===void 0&&(r=null),super("This looks like a network error, the endpoint might be blocked by an internet provider or a firewall."),this.cause=e,this.isNetworkError=!0,this.request=r}},Vr=Vs;function Js(){return fetch(...arguments).catch(t=>{throw t.name==="AbortError"?t:new Vr(t)})}function Ht(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var Qs=class extends Error{constructor(e,r){super(e),this.cause=r?.cause,this.cause&&Ht(this.cause,"isNetworkError")?this.isNetworkError=this.cause.isNetworkError:this.isNetworkError=!1}},Jr=Qs;var gn=Se(cs(),1);function Kl(t,e,r){let{progress:s,bytesUploaded:i,bytesTotal:o}=e;s&&(t.uppy.log(`Upload progress: ${s}`),t.uppy.emit("upload-progress",r,{uploader:t,bytesUploaded:i,bytesTotal:o}))}var yn=(0,gn.default)(Kl,300,{leading:!0,trailing:!0});function Ys(t){var e;let s=(e=/^(?:https?:\/\/|\/\/)?(?:[^@\n]+@)?(?:www\.)?([^\n]+)/i.exec(t))==null?void 0:e[1];return`${/^http:\/\//i.test(t)?"ws":"wss"}://${s}`}var Zs=class extends Error{constructor(){super("Authorization required"),this.name="AuthError",this.isAuthError=!0}},vn=Zs;var _n;function xe(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var Gl=0;function Qr(t){return"__private_"+Gl+++"_"+t}var Xl={version:"3.8.0"};function Vl(t){return t.replace(/\/$/,"")}var bn=10,Jl=5*60*1e3,wn=401,ti=class extends Error{constructor(e){let{statusCode:r,message:s}=e;super(s),this.name="HttpError",this.statusCode=r}};async function Ql(t){if(t.status===wn)throw new vn;if(t.ok)return t.json();let e=`Failed request with status: ${t.status}. ${t.statusText}`,r;try{r=await t.json(),r.message&&(e=`${e} message: ${r.message}`),r.requestId&&(e=`${e} request-Id: ${r.requestId}`)}catch(s){throw new Error(e,{cause:s})}throw t.status>=400&&t.status<=499&&r.message?new ln(r.message):new ti({statusCode:t.status,message:e})}var Ae=Qr("companionHeaders"),Wt=Qr("getUrl"),ei=Qr("requestSocketToken"),Kt=Qr("awaitRemoteFileUpload");_n=Symbol.for("uppy test: getCompanionHeaders");var ve=class{constructor(e,r){Object.defineProperty(this,Kt,{value:Zl}),Object.defineProperty(this,Wt,{value:Yl}),Object.defineProperty(this,Ae,{writable:!0,value:void 0}),Object.defineProperty(this,ei,{writable:!0,value:async s=>{var i;let{file:o,postBody:n,signal:a}=s;if(((i=o.remote)==null?void 0:i.url)==null)throw new Error("Cannot connect to an undefined URL");return(await this.post(o.remote.url,{...o.remote.body,...n},{signal:a})).token}}),this.uppy=e,this.opts=r,this.onReceiveResponse=this.onReceiveResponse.bind(this),xe(this,Ae)[Ae]=r?.companionHeaders}setCompanionHeaders(e){xe(this,Ae)[Ae]=e}[_n](){return xe(this,Ae)[Ae]}get hostname(){let{companion:e}=this.uppy.getState(),r=this.opts.companionUrl;return Vl(e&&e[r]?e[r]:r)}async headers(e){return e===void 0&&(e=!1),{...{Accept:"application/json",...e?void 0:{"Content-Type":"application/json"}},...xe(this,Ae)[Ae]}}onReceiveResponse(e){let{headers:r}=e,i=this.uppy.getState().companion||{},o=this.opts.companionUrl;r.has("i-am")&&r.get("i-am")!==i[o]&&this.uppy.setState({companion:{...i,[o]:r.get("i-am")}})}async request(e){let{path:r,method:s="GET",data:i,skipPostResponse:o,signal:n}=e;try{let a=await this.headers(!i),l=await Js(xe(this,Wt)[Wt](r),{method:s,signal:n,headers:a,credentials:this.opts.companionCookiesRule||"same-origin",body:i?JSON.stringify(i):null});return o||this.onReceiveResponse(l),await Ql(l)}catch(a){throw a.isAuthError||a.name==="UserFacingApiError"||a.name==="AbortError"?a:new Jr(`Could not ${s} ${xe(this,Wt)[Wt](r)}`,{cause:a})}}async get(e,r){return typeof r=="boolean"&&(r={skipPostResponse:r}),this.request({...r,path:e})}async post(e,r,s){return typeof s=="boolean"&&(s={skipPostResponse:s}),this.request({...s,path:e,method:"POST",data:r})}async delete(e,r,s){return typeof s=="boolean"&&(s={skipPostResponse:s}),this.request({...s,path:e,method:"DELETE",data:r})}async uploadRemoteFile(e,r,s){var i=this;try{let{signal:o,getQueue:n}=s||{};return await Xr(async()=>{var a;let l=(a=this.uppy.getFile(e.id))==null?void 0:a.serverToken;if(l!=null)return this.uppy.log(`Connecting to exiting websocket ${l}`),xe(this,Kt)[Kt]({file:e,queue:n(),signal:o});let p=await n().wrapPromiseFunction(async function(){try{return await xe(i,ei)[ei](...arguments)}catch(u){if(u.isAuthError)throw new St(u);if(u.cause==null)throw u;let h=u.cause,c=()=>[408,409,429,418,423].includes(h.statusCode)||h.statusCode>=500&&h.statusCode<=599&&![501,505].includes(h.statusCode);throw h.name==="HttpError"&&!c()?new St(h):h}},{priority:-1})({file:e,postBody:r,signal:o}).abortOn(o);if(this.uppy.getFile(e.id))return this.uppy.setFileState(e.id,{serverToken:p}),xe(this,Kt)[Kt]({file:this.uppy.getFile(e.id),queue:n(),signal:o})},{retries:bn,signal:o,onFailedAttempt:a=>this.uppy.log(`Retrying upload due to: ${a.message}`,"warning")})}catch(o){if(o.name==="AbortError")return;throw this.uppy.emit("upload-error",e,o),o}}};function Yl(t){return/^(https?:|)\/\//.test(t)?t:`${this.hostname}/${t}`}async function Zl(t){let{file:e,queue:r,signal:s}=t,i,{capabilities:o}=this.uppy.getState();try{return await new Promise((n,a)=>{let l=e.serverToken,d=Ys(e.remote.companionUrl),p,u,h,{isPaused:c}=e,f=(P,U)=>{if(p==null||p.readyState!==p.OPEN){var O;this.uppy.log(`Cannot send "${P}" to socket ${e.id} because the socket state was ${String((O=p)==null?void 0:O.readyState)}`,"warning");return}p.send(JSON.stringify({action:P,payload:U??{}}))};function b(){o.resumableUploads&&f(c?"pause":"resume")}let _=async()=>{u&&u.abort(),u=new AbortController;let P=O=>{var ee;this.uppy.setFileState(e.id,{serverToken:null}),(ee=u)==null||ee.abort==null||ee.abort(),a(O)};function U(){clearTimeout(h),!c&&(h=setTimeout(()=>P(new Error("Timeout waiting for message from Companion socket")),Jl))}try{await r.wrapPromiseFunction(async()=>{await Xr(async()=>new Promise((ee,ns)=>{p=new WebSocket(`${d}/api/${l}`),U(),p.addEventListener("close",()=>{p=void 0,ns(new Error("Socket closed unexpectedly"))}),p.addEventListener("error",Ut=>{var De;this.uppy.log(`Companion socket error ${JSON.stringify(Ut)}, closing socket`,"warning"),(De=p)==null||De.close()}),p.addEventListener("open",()=>{b()}),p.addEventListener("message",Ut=>{U();try{let{action:vt,payload:we}=JSON.parse(Ut.data);switch(vt){case"progress":{yn(this,we,this.uppy.getFile(e.id));break}case"success":{var De,wr,Sr,ze;let _t=(De=we.response)==null?void 0:De.responseText;this.uppy.emit("upload-success",this.uppy.getFile(e.id),{uploadURL:we.url,status:(wr=(Sr=we.response)==null?void 0:Sr.status)!=null?wr:200,body:_t?JSON.parse(_t):void 0}),(ze=u)==null||ze.abort==null||ze.abort(),n();break}case"error":{let{message:_t}=we.error;throw Object.assign(new Error(_t),{cause:we.error})}default:this.uppy.log(`Companion socket unknown action ${vt}`,"warning")}}catch(vt){P(vt)}});let as=()=>{this.uppy.log(`Closing socket ${e.id}`,"info"),clearTimeout(h),p&&p.close(),p=void 0};u.signal.addEventListener("abort",()=>{as()})}),{retries:bn,signal:u.signal,onFailedAttempt:()=>{u.signal.aborted||this.uppy.log(`Retrying websocket ${e.id}`,"info")}})})().abortOn(u.signal)}catch(O){if(u.signal.aborted)return;P(O)}},v=P=>{if(o.resumableUploads)if(c=P,p&&b(),P){var U;(U=u)==null||U.abort==null||U.abort()}else _()},F=P=>{var U;o.individualCancellation&&P.id===e.id&&(f("cancel"),(U=u)==null||U.abort==null||U.abort(),this.uppy.log(`upload ${e.id} was removed`,"info"),n())},x=P=>{var U;let{reason:O}=P;O==="user"&&f("cancel"),(U=u)==null||U.abort==null||U.abort(),this.uppy.log(`upload ${e.id} was canceled`,"info"),n()},A=(P,U)=>{P===e.id&&v(U)},k=()=>v(!0),E=()=>v(!1);this.uppy.on("file-removed",F),this.uppy.on("cancel-all",x),this.uppy.on("upload-pause",A),this.uppy.on("pause-all",k),this.uppy.on("resume-all",E),i=()=>{this.uppy.off("file-removed",F),this.uppy.off("cancel-all",x),this.uppy.off("upload-pause",A),this.uppy.off("pause-all",k),this.uppy.off("resume-all",E)},s.addEventListener("abort",()=>{var P;(P=u)==null||P.abort()}),_()})}finally{i?.()}}ve.VERSION=Xl.version;var Tn=Se(ls(),1),Sn,Pn;function j(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var tu=0;function Gt(t){return"__private_"+tu+++"_"+t}var Ce=Gt("queued"),Ye=Gt("emitter"),_e=Gt("isOpen"),L=Gt("socket"),ri=Gt("handleMessage");Sn=Symbol.for("uppy test: getSocket");Pn=Symbol.for("uppy test: getQueued");var Yr=class{constructor(e){Object.defineProperty(this,Ce,{writable:!0,value:[]}),Object.defineProperty(this,Ye,{writable:!0,value:(0,Tn.default)()}),Object.defineProperty(this,_e,{writable:!0,value:!1}),Object.defineProperty(this,L,{writable:!0,value:void 0}),Object.defineProperty(this,ri,{writable:!0,value:r=>{try{let s=JSON.parse(r.data);this.emit(s.action,s.payload)}catch(s){console.log(s)}}}),this.opts=e,(!e||e.autoOpen!==!1)&&this.open()}get isOpen(){return j(this,_e)[_e]}[Sn](){return j(this,L)[L]}[Pn](){return j(this,Ce)[Ce]}open(){j(this,L)[L]==null&&(j(this,L)[L]=new WebSocket(this.opts.target),j(this,L)[L].onopen=()=>{for(j(this,_e)[_e]=!0;j(this,Ce)[Ce].length>0&&j(this,_e)[_e];){let e=j(this,Ce)[Ce].shift();this.send(e.action,e.payload)}},j(this,L)[L].onclose=()=>{j(this,_e)[_e]=!1,j(this,L)[L]=null},j(this,L)[L].onmessage=j(this,ri)[ri])}close(){var e;(e=j(this,L)[L])==null||e.close()}send(e,r){if(!j(this,_e)[_e]){j(this,Ce)[Ce].push({action:e,payload:r});return}j(this,L)[L].send(JSON.stringify({action:e,payload:r}))}on(e,r){j(this,Ye)[Ye].on(e,r)}emit(e,r){j(this,Ye)[Ye].emit(e,r)}once(e,r){j(this,Ye)[Ye].once(e,r)}};function Re(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var ru=0;function Fn(t){return"__private_"+ru+++"_"+t}var X=Fn("uppy"),Xt=Fn("events"),Vt=class{constructor(e){Object.defineProperty(this,X,{writable:!0,value:void 0}),Object.defineProperty(this,Xt,{writable:!0,value:[]}),Re(this,X)[X]=e}on(e,r){return Re(this,Xt)[Xt].push([e,r]),Re(this,X)[X].on(e,r)}remove(){for(let[e,r]of Re(this,Xt)[Xt].splice(0))Re(this,X)[X].off(e,r)}onFilePause(e,r){this.on("upload-pause",(s,i)=>{e===s&&r(i)})}onFileRemove(e,r){this.on("file-removed",s=>{e===s.id&&r(s.id)})}onPause(e,r){this.on("upload-pause",(s,i)=>{e===s&&r(i)})}onRetry(e,r){this.on("upload-retry",s=>{e===s&&r()})}onRetryAll(e,r){this.on("retry-all",()=>{Re(this,X)[X].getFile(e)&&r()})}onPauseAll(e,r){this.on("pause-all",()=>{Re(this,X)[X].getFile(e)&&r()})}onCancelAll(e,r){var s=this;this.on("cancel-all",function(){Re(s,X)[X].getFile(e)&&r(...arguments)})}onResumeAll(e,r){this.on("resume-all",()=>{Re(this,X)[X].getFile(e)&&r()})}};function w(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var su=0;function re(t){return"__private_"+su+++"_"+t}function iu(t){return new Error("Cancelled",{cause:t})}function En(t){if(t!=null){var e;let r=()=>this.abort(t.reason);t.addEventListener("abort",r,{once:!0});let s=()=>{t.removeEventListener("abort",r)};(e=this.then)==null||e.call(this,s,s)}return this}var le=re("activeRequests"),J=re("queuedHandlers"),ae=re("paused"),Ze=re("pauseTimer"),V=re("downLimit"),et=re("upperLimit"),ke=re("rateLimitingTimer"),Jt=re("call"),$e=re("queueNext"),oi=re("next"),si=re("queue"),ni=re("dequeue"),ii=re("resume"),tt=re("increaseLimit"),Pt=class{constructor(e){Object.defineProperty(this,ni,{value:uu}),Object.defineProperty(this,si,{value:lu}),Object.defineProperty(this,oi,{value:au}),Object.defineProperty(this,$e,{value:nu}),Object.defineProperty(this,Jt,{value:ou}),Object.defineProperty(this,le,{writable:!0,value:0}),Object.defineProperty(this,J,{writable:!0,value:[]}),Object.defineProperty(this,ae,{writable:!0,value:!1}),Object.defineProperty(this,Ze,{writable:!0,value:void 0}),Object.defineProperty(this,V,{writable:!0,value:1}),Object.defineProperty(this,et,{writable:!0,value:void 0}),Object.defineProperty(this,ke,{writable:!0,value:void 0}),Object.defineProperty(this,ii,{writable:!0,value:()=>this.resume()}),Object.defineProperty(this,tt,{writable:!0,value:()=>{if(w(this,ae)[ae]){w(this,ke)[ke]=setTimeout(w(this,tt)[tt],0);return}w(this,V)[V]=this.limit,this.limit=Math.ceil((w(this,et)[et]+w(this,V)[V])/2);for(let r=w(this,V)[V];r<=this.limit;r++)w(this,$e)[$e]();w(this,et)[et]-w(this,V)[V]>3?w(this,ke)[ke]=setTimeout(w(this,tt)[tt],2e3):w(this,V)[V]=Math.floor(w(this,V)[V]/2)}}),typeof e!="number"||e===0?this.limit=1/0:this.limit=e}run(e,r){return!w(this,ae)[ae]&&w(this,le)[le]<this.limit?w(this,Jt)[Jt](e):w(this,si)[si](e,r)}wrapSyncFunction(e,r){var s=this;return function(){for(var i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];let a=s.run(()=>(e(...o),queueMicrotask(()=>a.done()),()=>{}),r);return{abortOn:En,abort(){a.abort()}}}}wrapPromiseFunction(e,r){var s=this;return function(){for(var i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];let a,l=new Promise((d,p)=>{a=s.run(()=>{let u,h;try{h=Promise.resolve(e(...o))}catch(c){h=Promise.reject(c)}return h.then(c=>{u?p(u):(a.done(),d(c))},c=>{u?p(u):(a.done(),p(c))}),c=>{u=iu(c)}},r)});return l.abort=d=>{a.abort(d)},l.abortOn=En,l}}resume(){w(this,ae)[ae]=!1,clearTimeout(w(this,Ze)[Ze]);for(let e=0;e<this.limit;e++)w(this,$e)[$e]()}pause(e){e===void 0&&(e=null),w(this,ae)[ae]=!0,clearTimeout(w(this,Ze)[Ze]),e!=null&&(w(this,Ze)[Ze]=setTimeout(w(this,ii)[ii],e))}rateLimit(e){clearTimeout(w(this,ke)[ke]),this.pause(e),this.limit>1&&Number.isFinite(this.limit)&&(w(this,et)[et]=this.limit-1,this.limit=w(this,V)[V],w(this,ke)[ke]=setTimeout(w(this,tt)[tt],e))}get isPaused(){return w(this,ae)[ae]}};function ou(t){w(this,le)[le]+=1;let e=!1,r;try{r=t()}catch(s){throw w(this,le)[le]-=1,s}return{abort:s=>{e||(e=!0,w(this,le)[le]-=1,r?.(s),w(this,$e)[$e]())},done:()=>{e||(e=!0,w(this,le)[le]-=1,w(this,$e)[$e]())}}}function nu(){queueMicrotask(()=>w(this,oi)[oi]())}function au(){if(w(this,ae)[ae]||w(this,le)[le]>=this.limit||w(this,J)[J].length===0)return;let t=w(this,J)[J].shift();if(t==null)throw new Error("Invariant violation: next is null");let e=w(this,Jt)[Jt](t.fn);t.abort=e.abort,t.done=e.done}function lu(t,e){let r={fn:t,priority:e?.priority||0,abort:()=>{w(this,ni)[ni](r)},done:()=>{throw new Error("Cannot mark a queued request as done: this indicates a bug")}},s=w(this,J)[J].findIndex(i=>r.priority>i.priority);return s===-1?w(this,J)[J].push(r):w(this,J)[J].splice(s,0,r),r}function uu(t){let e=w(this,J)[J].indexOf(t);e!==-1&&w(this,J)[J].splice(e,1)}var Zr=Symbol("__queue");function es(t){let e=r=>"error"in r&&!!r.error;return t.filter(r=>!e(r))}function ts(t){return t.filter(e=>{var r;return!((r=e.progress)!=null&&r.uploadStarted)||!e.isRestored})}var{AbortController:rs}=globalThis,{AbortSignal:Bc}=globalThis,ss=function(t,e){t===void 0&&(t="Aborted");let r=new DOMException(t,"AbortError");return e!=null&&Ht(e,"cause")&&Object.defineProperty(r,"cause",{__proto__:null,configurable:!0,writable:!0,value:e.cause}),r};function y(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var du=0;function I(t){return"__private_"+du+++"_"+t}var pu=1024*1024,Un={getChunkSize(t){return Math.ceil(t.size/1e4)},onProgress(){},onPartComplete(){},onSuccess(){},onError(t){throw t}};function cu(t){if(typeof t=="string")return parseInt(t,10);if(typeof t=="number")return t;throw new TypeError("Expected a number")}var rr=Symbol("pausing upload, not an actual error"),H=I("abortController"),B=I("chunks"),Q=I("chunkState"),ue=I("data"),de=I("file"),sr=I("uploadHasStarted"),Qt=I("onError"),it=I("onSuccess"),je=I("shouldUseMultipart"),st=I("isRestoring"),ir=I("onReject"),rt=I("maxMultipartParts"),Zt=I("minPartSize"),ai=I("initChunks"),li=I("createUpload"),Yt=I("resumeUpload"),er=I("onPartProgress"),tr=I("onPartComplete"),ui=I("abortUpload"),di=class{constructor(e,r){var s,i;Object.defineProperty(this,ui,{value:gu}),Object.defineProperty(this,Yt,{value:mu}),Object.defineProperty(this,li,{value:fu}),Object.defineProperty(this,ai,{value:hu}),Object.defineProperty(this,H,{writable:!0,value:new rs}),Object.defineProperty(this,B,{writable:!0,value:void 0}),Object.defineProperty(this,Q,{writable:!0,value:void 0}),Object.defineProperty(this,ue,{writable:!0,value:void 0}),Object.defineProperty(this,de,{writable:!0,value:void 0}),Object.defineProperty(this,sr,{writable:!0,value:!1}),Object.defineProperty(this,Qt,{writable:!0,value:void 0}),Object.defineProperty(this,it,{writable:!0,value:void 0}),Object.defineProperty(this,je,{writable:!0,value:void 0}),Object.defineProperty(this,st,{writable:!0,value:void 0}),Object.defineProperty(this,ir,{writable:!0,value:o=>o?.cause===rr?null:y(this,Qt)[Qt](o)}),Object.defineProperty(this,rt,{writable:!0,value:1e4}),Object.defineProperty(this,Zt,{writable:!0,value:5*pu}),Object.defineProperty(this,er,{writable:!0,value:o=>n=>{if(!n.lengthComputable)return;y(this,Q)[Q][o].uploaded=cu(n.loaded);let a=y(this,Q)[Q].reduce((l,d)=>l+d.uploaded,0);this.options.onProgress(a,y(this,ue)[ue].size)}}),Object.defineProperty(this,tr,{writable:!0,value:o=>n=>{y(this,B)[B][o]=null,y(this,Q)[Q][o].etag=n,y(this,Q)[Q][o].done=!0;let a={PartNumber:o+1,ETag:n};this.options.onPartComplete(a)}}),this.options={...Un,...r},(i=(s=this.options).getChunkSize)!=null||(s.getChunkSize=Un.getChunkSize),y(this,ue)[ue]=e,y(this,de)[de]=r.file,y(this,it)[it]=this.options.onSuccess,y(this,Qt)[Qt]=this.options.onError,y(this,je)[je]=this.options.shouldUseMultipart,y(this,st)[st]=r.uploadId&&r.key,y(this,ai)[ai]()}start(){y(this,sr)[sr]?(y(this,H)[H].signal.aborted||y(this,H)[H].abort(rr),y(this,H)[H]=new rs,y(this,Yt)[Yt]()):y(this,st)[st]?(this.options.companionComm.restoreUploadFile(y(this,de)[de],{uploadId:this.options.uploadId,key:this.options.key}),y(this,Yt)[Yt]()):y(this,li)[li]()}pause(){y(this,H)[H].abort(rr),y(this,H)[H]=new rs}abort(e){e!=null&&e.really?y(this,ui)[ui]():this.pause()}get chunkState(){return y(this,Q)[Q]}};function hu(){let t=y(this,ue)[ue].size,e=typeof y(this,je)[je]=="function"?y(this,je)[je](y(this,de)[de]):!!y(this,je)[je];if(e&&t>y(this,Zt)[Zt]){let r=Math.max(this.options.getChunkSize(y(this,ue)[ue]),y(this,Zt)[Zt]),s=Math.floor(t/r);s>y(this,rt)[rt]&&(s=y(this,rt)[rt],r=t/y(this,rt)[rt]),y(this,B)[B]=Array(s);for(let i=0,o=0;i<t;i+=r,o++){let n=Math.min(t,i+r),a=()=>{let l=i;return y(this,ue)[ue].slice(l,n)};if(y(this,B)[B][o]={getData:a,onProgress:y(this,er)[er](o),onComplete:y(this,tr)[tr](o),shouldUseMultipart:e},y(this,st)[st]){let l=i+r>t?t-i:r;y(this,B)[B][o].setAsUploaded=()=>{y(this,B)[B][o]=null,y(this,Q)[Q][o].uploaded=l}}}}else y(this,B)[B]=[{getData:()=>y(this,ue)[ue],onProgress:y(this,er)[er](0),onComplete:y(this,tr)[tr](0),shouldUseMultipart:e}];y(this,Q)[Q]=y(this,B)[B].map(()=>({uploaded:0}))}function fu(){this.options.companionComm.uploadFile(y(this,de)[de],y(this,B)[B],y(this,H)[H].signal).then(y(this,it)[it],y(this,ir)[ir]),y(this,sr)[sr]=!0}function mu(){this.options.companionComm.resumeUploadFile(y(this,de)[de],y(this,B)[B],y(this,H)[H].signal).then(y(this,it)[it],y(this,ir)[ir])}function gu(){y(this,H)[H].abort(),this.options.companionComm.abortFileUpload(y(this,de)[de]).catch(t=>this.options.log(t))}var On=di;function D(t){if(t!=null&&t.aborted)throw ss("The operation was aborted",{cause:t.reason})}function yu(t){let{method:e="PUT",CanonicalUri:r="/",CanonicalQueryString:s="",SignedHeaders:i,HashedPayload:o}=t,n=Object.keys(i).map(a=>a.toLowerCase()).sort();return[e,r,s,...n.map(a=>`${a}:${i[a]}`),"",n.join(";"),o].join(`
`)}var pi=new TextEncoder,ci={name:"HMAC",hash:"SHA-256"};async function vu(t){let{subtle:e}=globalThis.crypto;return e.digest(ci.hash,pi.encode(t))}async function _u(t){let{subtle:e}=globalThis.crypto;return e.importKey("raw",typeof t=="string"?pi.encode(t):t,ci,!1,["sign"])}function xn(t){let e=new Uint8Array(t),r="";for(let s=0;s<e.length;s++)r+=e[s].toString(16).padStart(2,"0");return r}async function or(t,e){let{subtle:r}=globalThis.crypto;return r.sign(ci,await _u(t),pi.encode(e))}async function hi(t){let{accountKey:e,accountSecret:r,sessionToken:s,bucketName:i,Key:o,Region:n,expires:a,uploadId:l,partNumber:d}=t,p="s3",u=`${i}.${p}.${n}.amazonaws.com`,h=`/${encodeURI(o).replace(/[;?:@&=+$,#!'()*]/g,ee=>`%${ee.charCodeAt(0).toString(16).toUpperCase()}`)}`,c="UNSIGNED-PAYLOAD",f=new Date().toISOString().replace(/[-:]|\.\d+/g,""),b=f.slice(0,8),_=`${b}/${n}/${p}/aws4_request`,v=new URL(`https://${u}${h}`);v.searchParams.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),v.searchParams.set("X-Amz-Content-Sha256",c),v.searchParams.set("X-Amz-Credential",`${e}/${_}`),v.searchParams.set("X-Amz-Date",f),v.searchParams.set("X-Amz-Expires",a),v.searchParams.set("X-Amz-Security-Token",s),v.searchParams.set("X-Amz-SignedHeaders","host"),d&&v.searchParams.set("partNumber",d),l&&v.searchParams.set("uploadId",l),v.searchParams.set("x-id",d&&l?"UploadPart":"PutObject");let F=yu({CanonicalUri:h,CanonicalQueryString:v.search.slice(1),SignedHeaders:{host:u},HashedPayload:c}),x=xn(await vu(F)),A=["AWS4-HMAC-SHA256",f,_,x].join(`
`),k=await or(`AWS4${r}`,b),E=await or(k,n),P=await or(E,p),U=await or(P,"aws4_request"),O=xn(await or(U,A));return v.searchParams.set("X-Amz-Signature",O),v}function S(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var bu=0;function Y(t){return"__private_"+bu+++"_"+t}function wu(t){let e=new URL(t);return e.search="",e.hash="",e.href}var nr=Y("abortMultipartUpload"),W=Y("cache"),ar=Y("createMultipartUpload"),lr=Y("fetchSignature"),pr=Y("getUploadParameters"),ur=Y("listParts"),lt=Y("previousRetryDelay"),ut=Y("requests"),ot=Y("retryDelays"),nt=Y("sendCompletionRequest"),at=Y("setS3MultipartState"),dt=Y("uploadPartBytes"),K=Y("getFile"),fi=Y("shouldRetry"),dr=Y("nonMultipartUpload"),is=class{constructor(e,r,s,i){Object.defineProperty(this,dr,{value:Pu}),Object.defineProperty(this,fi,{value:Su}),Object.defineProperty(this,nr,{writable:!0,value:void 0}),Object.defineProperty(this,W,{writable:!0,value:new WeakMap}),Object.defineProperty(this,ar,{writable:!0,value:void 0}),Object.defineProperty(this,lr,{writable:!0,value:void 0}),Object.defineProperty(this,pr,{writable:!0,value:void 0}),Object.defineProperty(this,ur,{writable:!0,value:void 0}),Object.defineProperty(this,lt,{writable:!0,value:void 0}),Object.defineProperty(this,ut,{writable:!0,value:void 0}),Object.defineProperty(this,ot,{writable:!0,value:void 0}),Object.defineProperty(this,nt,{writable:!0,value:void 0}),Object.defineProperty(this,at,{writable:!0,value:void 0}),Object.defineProperty(this,dt,{writable:!0,value:void 0}),Object.defineProperty(this,K,{writable:!0,value:void 0}),S(this,ut)[ut]=e,S(this,at)[at]=s,S(this,K)[K]=i,this.setOptions(r)}setOptions(e){let r=S(this,ut)[ut];if("abortMultipartUpload"in e&&(S(this,nr)[nr]=r.wrapPromiseFunction(e.abortMultipartUpload,{priority:1})),"createMultipartUpload"in e&&(S(this,ar)[ar]=r.wrapPromiseFunction(e.createMultipartUpload,{priority:-1})),"signPart"in e&&(S(this,lr)[lr]=r.wrapPromiseFunction(e.signPart)),"listParts"in e&&(S(this,ur)[ur]=r.wrapPromiseFunction(e.listParts)),"completeMultipartUpload"in e&&(S(this,nt)[nt]=r.wrapPromiseFunction(e.completeMultipartUpload,{priority:1})),"retryDelays"in e){var s;S(this,ot)[ot]=(s=e.retryDelays)!=null?s:[]}"uploadPartBytes"in e&&(S(this,dt)[dt]=r.wrapPromiseFunction(e.uploadPartBytes,{priority:1/0})),"getUploadParameters"in e&&(S(this,pr)[pr]=r.wrapPromiseFunction(e.getUploadParameters))}async getUploadId(e,r){let s;for(;(s=S(this,W)[W].get(e.data))!=null;)try{return await s}catch{}let i=S(this,ar)[ar](S(this,K)[K](e),r),o=()=>{i.abort(r.reason),S(this,W)[W].delete(e.data)};return r.addEventListener("abort",o,{once:!0}),S(this,W)[W].set(e.data,i),i.then(async n=>{r.removeEventListener("abort",o),S(this,at)[at](e,n),S(this,W)[W].set(e.data,n)},()=>{r.removeEventListener("abort",o),S(this,W)[W].delete(e.data)}),i}async abortFileUpload(e){let r=S(this,W)[W].get(e.data);if(r==null)return;S(this,W)[W].delete(e.data),S(this,at)[at](e,Object.create(null));let s;try{s=await r}catch{return}await S(this,nr)[nr](S(this,K)[K](e),s)}async uploadFile(e,r,s){if(D(s),r.length===1&&!r[0].shouldUseMultipart)return S(this,dr)[dr](e,r[0],s);let{uploadId:i,key:o}=await this.getUploadId(e,s);D(s);try{let n=await Promise.all(r.map((a,l)=>this.uploadChunk(e,l+1,a,s)));return D(s),await S(this,nt)[nt](S(this,K)[K](e),{key:o,uploadId:i,parts:n,signal:s},s).abortOn(s)}catch(n){throw n?.cause!==rr&&n?.name!=="AbortError"&&this.abortFileUpload(e),n}}restoreUploadFile(e,r){S(this,W)[W].set(e.data,r)}async resumeUploadFile(e,r,s){if(D(s),r.length===1&&r[0]!=null&&!r[0].shouldUseMultipart)return S(this,dr)[dr](e,r[0],s);let{uploadId:i,key:o}=await this.getUploadId(e,s);D(s);let n=await S(this,ur)[ur](S(this,K)[K](e),{uploadId:i,key:o,signal:s},s).abortOn(s);D(s);let a=await Promise.all(r.map((l,d)=>{let p=d+1,u=n.find(h=>{let{PartNumber:c}=h;return c===p});return u==null?this.uploadChunk(e,p,l,s):(l==null||l.setAsUploaded==null||l.setAsUploaded(),{PartNumber:p,ETag:u.ETag})}));return D(s),S(this,nt)[nt](S(this,K)[K](e),{key:o,uploadId:i,parts:a,signal:s},s).abortOn(s)}async uploadChunk(e,r,s,i){D(i);let{uploadId:o,key:n}=await this.getUploadId(e,i),a=S(this,ot)[ot].values(),l=S(this,ot)[ot].values(),d=()=>{let p=a.next();return p==null||p.done?null:p.value};for(;;){D(i);let p=s.getData(),{onProgress:u,onComplete:h}=s,c;try{c=await S(this,lr)[lr](S(this,K)[K](e),{uploadId:o,key:n,partNumber:r,body:p,signal:i}).abortOn(i)}catch(f){let b=d();if(b==null||i.aborted)throw f;await new Promise(_=>setTimeout(_,b));continue}D(i);try{return{PartNumber:r,...await S(this,dt)[dt]({signature:c,body:p,size:p.size,onProgress:u,onComplete:h,signal:i}).abortOn(i)}}catch(f){if(!await S(this,fi)[fi](f,l))throw f}}}};async function Su(t,e){var r;let s=S(this,ut)[ut],i=t==null||(r=t.source)==null?void 0:r.status;if(i==null)return!1;if(i===403&&t.message==="Request has expired"){if(!s.isPaused){if(s.limit===1||S(this,lt)[lt]==null){let o=e.next();if(o==null||o.done)return!1;S(this,lt)[lt]=o.value}s.rateLimit(0),await new Promise(o=>setTimeout(o,S(this,lt)[lt]))}}else if(i===429){if(!s.isPaused){let o=e.next();if(o==null||o.done)return!1;s.rateLimit(o.value)}}else{if(i>400&&i<500&&i!==409)return!1;if(typeof navigator<"u"&&navigator.onLine===!1)s.isPaused||(s.pause(),window.addEventListener("online",()=>{s.resume()},{once:!0}));else{let o=e.next();if(o==null||o.done)return!1;await new Promise(n=>setTimeout(n,o.value))}}return!0}async function Pu(t,e,r){let{method:s="POST",url:i,fields:o,headers:n}=await S(this,pr)[pr](S(this,K)[K](t),{signal:r}).abortOn(r),a,l=e.getData();if(s.toUpperCase()==="POST"){let h=new FormData;Object.entries(o).forEach(c=>{let[f,b]=c;return h.set(f,b)}),h.set("file",l),a=h}else a=l;let{onProgress:d,onComplete:p}=e,u=await S(this,dt)[dt]({signature:{url:i,headers:n,method:s},body:a,size:l.size,onProgress:d,onComplete:p,signal:r}).abortOn(r);return"location"in u?u:{location:wu(i),...u}}var Cn;function T(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var Tu=0;function fe(t){return"__private_"+Tu+++"_"+t}var Fu={version:"3.11.0"};function Tt(t){if(t!=null&&t.error){let e=new Error(t.message);throw Object.assign(e,t.error),e}return t}function Rn(t){let e=t.Expiration;if(e){let r=Math.floor((new Date(e)-Date.now())/1e3);if(r>9)return r}}function An(t){let{meta:e,allowedMetaFields:r,querify:s=!1}=t,i=r??Object.keys(e);return e?Object.fromEntries(i.filter(o=>e[o]!=null).map(o=>{let n=s?`metadata[${o}]`:o,a=String(e[o]);return[n,a]})):{}}var Eu={allowedMetaFields:null,limit:6,getTemporarySecurityCredentials:!1,shouldUseMultipart:t=>t.size!==0,retryDelays:[0,1e3,3e3,5e3],companionHeaders:{}},ct=fe("companionCommunicationQueue"),N=fe("client"),G=fe("cachedTemporaryCredentials"),mi=fe("getTemporarySecurityCredentials"),gi=fe("setS3MultipartState"),ht=fe("getFile"),yi=fe("uploadLocalFile"),vi=fe("getCompanionClientArgs"),cr=fe("upload"),pt=fe("setCompanionHeaders"),Me=fe("setResumableUploadsCapability"),hr=fe("resetResumableCapability");Cn=Symbol.for("uppy test: getClient");var Ft=class t extends Ue{constructor(e,r){var s;super(e,{...Eu,uploadPartBytes:t.uploadPartBytes,createMultipartUpload:null,listParts:null,abortMultipartUpload:null,completeMultipartUpload:null,signPart:null,getUploadParameters:null,...r}),Object.defineProperty(this,vi,{value:xu}),Object.defineProperty(this,yi,{value:Ou}),Object.defineProperty(this,mi,{value:Uu}),Object.defineProperty(this,ct,{writable:!0,value:void 0}),Object.defineProperty(this,N,{writable:!0,value:void 0}),Object.defineProperty(this,G,{writable:!0,value:void 0}),Object.defineProperty(this,gi,{writable:!0,value:(o,n)=>{let{key:a,uploadId:l}=n,d=this.uppy.getFile(o.id);d!=null&&this.uppy.setFileState(o.id,{s3Multipart:{...d.s3Multipart,key:a,uploadId:l}})}}),Object.defineProperty(this,ht,{writable:!0,value:o=>this.uppy.getFile(o.id)||o}),Object.defineProperty(this,cr,{writable:!0,value:async o=>{if(o.length===0)return;let n=this.uppy.getFilesByIds(o),a=es(n),l=ts(a);this.uppy.emit("upload-start",l);let d=a.map(u=>{if(u.isRemote){let h=()=>this.requests;T(this,Me)[Me](!1);let c=new AbortController,f=_=>{_.id===u.id&&c.abort()};this.uppy.on("file-removed",f);let b=this.uppy.getRequestClientForFile(u).uploadRemoteFile(u,T(this,vi)[vi](u),{signal:c.signal,getQueue:h});return this.requests.wrapSyncFunction(()=>{this.uppy.off("file-removed",f)},{priority:-1})(),b}return T(this,yi)[yi](u)}),p=await Promise.all(d);return T(this,Me)[Me](!0),p}}),Object.defineProperty(this,pt,{writable:!0,value:()=>{T(this,N)[N].setCompanionHeaders(this.opts.companionHeaders)}}),Object.defineProperty(this,Me,{writable:!0,value:o=>{let{capabilities:n}=this.uppy.getState();this.uppy.setState({capabilities:{...n,resumableUploads:o}})}}),Object.defineProperty(this,hr,{writable:!0,value:()=>{T(this,Me)[Me](!0)}}),this.type="uploader",this.id=this.opts.id||"AwsS3Multipart",this.title="AWS S3 Multipart",T(this,N)[N]=new ve(e,r);let i={createMultipartUpload:this.createMultipartUpload,listParts:this.listParts,abortMultipartUpload:this.abortMultipartUpload,completeMultipartUpload:this.completeMultipartUpload,signPart:r!=null&&r.getTemporarySecurityCredentials?this.createSignedURL:this.signPart,getUploadParameters:r!=null&&r.getTemporarySecurityCredentials?this.createSignedURL:this.getUploadParameters};for(let o of Object.keys(i))this.opts[o]==null&&(this.opts[o]=i[o].bind(this));r?.prepareUploadParts!=null&&r.signPart==null&&(this.opts.signPart=async(o,n)=>{let{uploadId:a,key:l,partNumber:d,body:p,signal:u}=n,{presignedUrls:h,headers:c}=await r.prepareUploadParts(o,{uploadId:a,key:l,parts:[{number:d,chunk:p}],signal:u});return{url:h?.[d],headers:c?.[d]}}),this.requests=(s=this.opts.rateLimitedQueue)!=null?s:new Pt(this.opts.limit),T(this,ct)[ct]=new is(this.requests,this.opts,T(this,gi)[gi],T(this,ht)[ht]),this.uploaders=Object.create(null),this.uploaderEvents=Object.create(null),this.uploaderSockets=Object.create(null)}[Cn](){return T(this,N)[N]}setOptions(e){T(this,ct)[ct].setOptions(e),super.setOptions(e),T(this,pt)[pt]()}resetUploaderReferences(e,r){this.uploaders[e]&&(this.uploaders[e].abort({really:r?.abort||!1}),this.uploaders[e]=null),this.uploaderEvents[e]&&(this.uploaderEvents[e].remove(),this.uploaderEvents[e]=null),this.uploaderSockets[e]&&(this.uploaderSockets[e].close(),this.uploaderSockets[e]=null)}assertHost(e){if(!this.opts.companionUrl)throw new Error(`Expected a \`companionUrl\` option containing a Companion address, or if you are not using Companion, a custom \`${e}\` implementation.`)}createMultipartUpload(e,r){this.assertHost("createMultipartUpload"),D(r);let s=An({meta:e.meta,allowedMetaFields:this.opts.allowedMetaFields});return T(this,N)[N].post("s3/multipart",{filename:e.name,type:e.type,metadata:s},{signal:r}).then(Tt)}listParts(e,r,s){var i;let{key:o,uploadId:n,signal:a}=r;(i=a)!=null||(a=s),this.assertHost("listParts"),D(a);let l=encodeURIComponent(o);return T(this,N)[N].get(`s3/multipart/${n}?key=${l}`,{signal:a}).then(Tt)}completeMultipartUpload(e,r,s){var i;let{key:o,uploadId:n,parts:a,signal:l}=r;(i=l)!=null||(l=s),this.assertHost("completeMultipartUpload"),D(l);let d=encodeURIComponent(o),p=encodeURIComponent(n);return T(this,N)[N].post(`s3/multipart/${p}/complete?key=${d}`,{parts:a},{signal:l}).then(Tt)}async createSignedURL(e,r){let s=await T(this,mi)[mi](r),i=Rn(s.credentials)||604800,{uploadId:o,key:n,partNumber:a}=r;return{method:"PUT",expires:i,fields:{},url:`${await hi({accountKey:s.credentials.AccessKeyId,accountSecret:s.credentials.SecretAccessKey,sessionToken:s.credentials.SessionToken,expires:i,bucketName:s.bucket,Region:s.region,Key:n??`${crypto.randomUUID()}-${e.name}`,uploadId:o,partNumber:a})}`,headers:{"Content-Type":e.type}}}signPart(e,r){let{uploadId:s,key:i,partNumber:o,signal:n}=r;if(this.assertHost("signPart"),D(n),s==null||i==null||o==null)throw new Error("Cannot sign without a key, an uploadId, and a partNumber");let a=encodeURIComponent(i);return T(this,N)[N].get(`s3/multipart/${s}/${o}?key=${a}`,{signal:n}).then(Tt)}abortMultipartUpload(e,r,s){var i;let{key:o,uploadId:n,signal:a}=r;(i=a)!=null||(a=s),this.assertHost("abortMultipartUpload");let l=encodeURIComponent(o),d=encodeURIComponent(n);return T(this,N)[N].delete(`s3/multipart/${d}?key=${l}`,void 0,{signal:a}).then(Tt)}getUploadParameters(e,r){let{meta:s}=e,{type:i,name:o}=s,n=An({meta:s,allowedMetaFields:this.opts.allowedMetaFields,querify:!0}),a=new URLSearchParams({filename:o,type:i,...n});return T(this,N)[N].get(`s3/params?${a}`,r)}static async uploadPartBytes(e){let{signature:{url:r,expires:s,headers:i,method:o="PUT"},body:n,size:a=n.size,onProgress:l,onComplete:d,signal:p}=e;if(D(p),r==null)throw new Error("Cannot upload to an undefined URL");return new Promise((u,h)=>{let c=new XMLHttpRequest;c.open(o,r,!0),i&&Object.keys(i).forEach(_=>{c.setRequestHeader(_,i[_])}),c.responseType="text",typeof s=="number"&&(c.timeout=s*1e3);function f(){c.abort()}function b(){p?.removeEventListener("abort",f)}p?.addEventListener("abort",f),c.upload.addEventListener("progress",_=>{l(_)}),c.addEventListener("abort",()=>{b(),h(ss())}),c.addEventListener("timeout",()=>{b();let _=new Error("Request has expired");_.source={status:403},h(_)}),c.addEventListener("load",_=>{if(b(),c.status===403&&c.responseText.includes("<Message>Request has expired</Message>")){let x=new Error("Request has expired");x.source=c,h(x);return}if(c.status<200||c.status>=300){let x=new Error("Non 2xx");x.source=c,h(x);return}l?.({loaded:a,lengthComputable:!0});let v=c.getResponseHeader("ETag"),F=c.getResponseHeader("Location");if(o.toUpperCase()==="POST"&&F===null&&console.warn("AwsS3/Multipart: Could not read the Location header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3-multipart#S3-Bucket-Configuration for instructions."),v===null){h(new Error("AwsS3/Multipart: Could not read the ETag header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3-multipart#S3-Bucket-Configuration for instructions."));return}d?.(v),u({ETag:v,...F?{location:F}:void 0})}),c.addEventListener("error",_=>{b();let v=new Error("Unknown error");v.source=_.target,h(v)}),c.send(n)})}install(){T(this,Me)[Me](!0),this.uppy.addPreProcessor(T(this,pt)[pt]),this.uppy.addUploader(T(this,cr)[cr]),this.uppy.on("cancel-all",T(this,hr)[hr])}uninstall(){this.uppy.removePreProcessor(T(this,pt)[pt]),this.uppy.removeUploader(T(this,cr)[cr]),this.uppy.off("cancel-all",T(this,hr)[hr])}};async function Uu(t){return D(t?.signal),T(this,G)[G]==null&&(this.opts.getTemporarySecurityCredentials===!0?(this.assertHost("getTemporarySecurityCredentials"),T(this,G)[G]=T(this,N)[N].get("s3/sts",t).then(Tt)):T(this,G)[G]=this.opts.getTemporarySecurityCredentials(t),T(this,G)[G]=await T(this,G)[G],setTimeout(()=>{T(this,G)[G]=null},(Rn(T(this,G)[G].credentials)||0)*500)),T(this,G)[G]}function Ou(t){var e=this;return new Promise((r,s)=>{let i=(d,p)=>{this.uppy.emit("upload-progress",this.uppy.getFile(t.id),{uploader:this,bytesUploaded:d,bytesTotal:p})},o=d=>{this.uppy.log(d),this.uppy.emit("upload-error",t,d),this.resetUploaderReferences(t.id),s(d)},n=d=>{let p={body:{...d},status:200,uploadURL:d.location};this.resetUploaderReferences(t.id),this.uppy.emit("upload-success",T(this,ht)[ht](t),p),d.location&&this.uppy.log(`Download ${t.name} from ${d.location}`),r()},a=new On(t.data,{companionComm:T(this,ct)[ct],log:function(){return e.uppy.log(...arguments)},getChunkSize:this.opts.getChunkSize?this.opts.getChunkSize.bind(this):null,onProgress:i,onError:o,onSuccess:n,onPartComplete:d=>{this.uppy.emit("s3-multipart:part-uploaded",T(this,ht)[ht](t),d)},file:t,shouldUseMultipart:this.opts.shouldUseMultipart,...t.s3Multipart});this.uploaders[t.id]=a;let l=new Vt(this.uppy);this.uploaderEvents[t.id]=l,l.onFileRemove(t.id,d=>{a.abort(),this.resetUploaderReferences(t.id,{abort:!0}),r(`upload ${d} was removed`)}),l.onCancelAll(t.id,d=>{d?.reason==="user"&&(a.abort(),this.resetUploaderReferences(t.id,{abort:!0})),r(`upload ${t.id} was canceled`)}),l.onFilePause(t.id,d=>{d?a.pause():a.start()}),l.onPauseAll(t.id,()=>{a.pause()}),l.onResumeAll(t.id,()=>{a.start()}),a.start()})}function xu(t){var e;return{...(e=t.remote)==null?void 0:e.body,protocol:"s3-multipart",size:t.data.size,metadata:t.meta}}Ft.VERSION=Fu.version;function Ne(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var Au=0;function kn(t){return"__private_"+Au+++"_"+t}var Z=kn("uppy"),fr=kn("events"),mr=class{constructor(e){Object.defineProperty(this,Z,{writable:!0,value:void 0}),Object.defineProperty(this,fr,{writable:!0,value:[]}),Ne(this,Z)[Z]=e}on(e,r){return Ne(this,fr)[fr].push([e,r]),Ne(this,Z)[Z].on(e,r)}remove(){for(let[e,r]of Ne(this,fr)[fr].splice(0))Ne(this,Z)[Z].off(e,r)}onFilePause(e,r){this.on("upload-pause",(s,i)=>{e===s&&r(i)})}onFileRemove(e,r){this.on("file-removed",s=>{e===s.id&&r(s.id)})}onPause(e,r){this.on("upload-pause",(s,i)=>{e===s&&r(i)})}onRetry(e,r){this.on("upload-retry",s=>{e===s&&r()})}onRetryAll(e,r){this.on("retry-all",()=>{Ne(this,Z)[Z].getFile(e)&&r()})}onPauseAll(e,r){this.on("pause-all",()=>{Ne(this,Z)[Z].getFile(e)&&r()})}onCancelAll(e,r){var s=this;this.on("cancel-all",function(){Ne(s,Z)[Z].getFile(e)&&r(...arguments)})}onResumeAll(e,r){this.on("resume-all",()=>{Ne(this,Z)[Z].getFile(e)&&r()})}};function me(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var Cu=0;function os(t){return"__private_"+Cu+++"_"+t}var Le=os("aliveTimer"),ft=os("isDone"),gr=os("onTimedOut"),mt=os("timeout"),_i=class{constructor(e,r){Object.defineProperty(this,Le,{writable:!0,value:void 0}),Object.defineProperty(this,ft,{writable:!0,value:!1}),Object.defineProperty(this,gr,{writable:!0,value:void 0}),Object.defineProperty(this,mt,{writable:!0,value:void 0}),me(this,mt)[mt]=e,me(this,gr)[gr]=r}progress(){me(this,ft)[ft]||me(this,mt)[mt]>0&&(clearTimeout(me(this,Le)[Le]),me(this,Le)[Le]=setTimeout(me(this,gr)[gr],me(this,mt)[mt]))}done(){me(this,ft)[ft]||(clearTimeout(me(this,Le)[Le]),me(this,Le)[Le]=void 0,me(this,ft)[ft]=!0)}},$n=_i;function Ru(t){return t?t.readyState!==0&&t.readyState!==4||t.status===0:!1}var jn=Ru;function Mn(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var ku=0;function Ln(t){return"__private_"+ku+++"_"+t}function Nn(t,e){if(jn(t))return new Vr(e,t);let r=new Jr("Upload error",{cause:e});return r.request=t,r}function $u(t){return t.data.slice(0,t.data.size,t.meta.type)}function ju(t,e,r){(Array.isArray(r.allowedMetaFields)?r.allowedMetaFields:Object.keys(e)).forEach(i=>{t.append(i,e[i])})}function Mu(t,e){let r=new FormData;ju(r,t.meta,e);let s=$u(t);return t.name?r.append(e.fieldName,s,t.meta.name):r.append(e.fieldName,s),r}var Nu=t=>t.data,bi=Ln("addEventHandlerForFile"),wi=Ln("addEventHandlerIfFileStillExists"),yr=class{constructor(e,r){Object.defineProperty(this,wi,{value:Bu}),Object.defineProperty(this,bi,{value:Lu}),this.uppy=e,this.opts={validateStatus(s){return s>=200&&s<300},...r},this.requests=r[Zr],this.uploaderEvents=Object.create(null),this.i18n=r.i18n}getOptions(e){var r;let{uppy:s}=this,i=s.getState().xhrUpload;return{...this.opts,...i||{},...e.xhrUpload||{},headers:{...this.opts.headers,...i?.headers,...(r=e.xhrUpload)==null?void 0:r.headers}}}uploadLocalFile(e){let r=this.getOptions(e);return new Promise((s,i)=>{let o=r.formData?Mu(e,r):Nu(e,r),n=new XMLHttpRequest;this.uploaderEvents[e.id]=new mr(this.uppy);let a=new $n(r.timeout,()=>{n.abort(),d.done();let p=new Error(this.i18n("timedOut",{seconds:Math.ceil(r.timeout/1e3)}));this.uppy.emit("upload-error",e,p),i(p)}),l=Fr();n.upload.addEventListener("loadstart",()=>{this.uppy.log(`[AwsS3/XHRUpload] ${l} started`)}),n.upload.addEventListener("progress",p=>{this.uppy.log(`[AwsS3/XHRUpload] ${l} progress: ${p.loaded} / ${p.total}`),a.progress(),p.lengthComputable&&this.uppy.emit("upload-progress",this.uppy.getFile(e.id),{uploader:this,bytesUploaded:p.loaded,bytesTotal:p.total})}),n.addEventListener("load",p=>{if(this.uppy.log(`[AwsS3/XHRUpload] ${l} finished`),a.done(),d.done(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null),r.validateStatus(p.target.status,n.responseText,n)){let f=r.getResponseData(n.responseText,n),b=f[r.responseUrlFieldName],_={status:p.target.status,body:f,uploadURL:b};return this.uppy.emit("upload-success",this.uppy.getFile(e.id),_),b&&this.uppy.log(`Download ${e.name} from ${b}`),s(e)}let u=r.getResponseData(n.responseText,n),h=Nn(n,r.getResponseError(n.responseText,n)),c={status:p.target.status,body:u};return this.uppy.emit("upload-error",e,h,c),i(h)}),n.addEventListener("error",()=>{this.uppy.log(`[AwsS3/XHRUpload] ${l} errored`),a.done(),d.done(),this.uploaderEvents[e.id]&&(this.uploaderEvents[e.id].remove(),this.uploaderEvents[e.id]=null);let p=Nn(n,r.getResponseError(n.responseText,n));return this.uppy.emit("upload-error",e,p),i(p)}),n.open(r.method.toUpperCase(),r.endpoint,!0),n.withCredentials=!!r.withCredentials,r.responseType!==""&&(n.responseType=r.responseType),Object.keys(r.headers).forEach(p=>{n.setRequestHeader(p,r.headers[p])});let d=this.requests.run(()=>(n.send(o),()=>{a.done(),n.abort()}),{priority:1});Mn(this,bi)[bi]("file-removed",e.id,()=>{d.abort(),i(new Error("File removed"))}),Mn(this,wi)[wi]("cancel-all",e.id,function(p){let{reason:u}=p===void 0?{}:p;u==="user"&&d.abort(),i(new Error("Upload cancelled"))})})}};function Lu(t,e,r){this.uploaderEvents[e].on(t,s=>{var i;let o=(i=s?.id)!=null?i:s;e===o&&r()})}function Bu(t,e,r){var s=this;this.uploaderEvents[e].on(t,function(){s.uppy.getFile(e)&&r(...arguments)})}function Iu(t){return t.replace(/;.*$/,"")}function qu(t,e){let r=e.headers?e.headers["content-type"]:e.getResponseHeader("Content-Type");if(typeof r=="string"){let s=Iu(r).toLowerCase();if(s==="application/xml"||s==="text/xml"||s==="text/html"&&/^<\?xml /.test(t))return!0}return!1}var Si=qu;var Bn={strings:{timedOut:"Upload stalled for %{seconds} seconds, aborting."}};var qn;function q(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var Du=0;function Et(t){return"__private_"+Du+++"_"+t}var zu={version:"3.6.2"};function Hu(t,e){return!t&&!e.startsWith("https://")&&!e.startsWith("http://")&&(e=`https://${e}`),new URL(e,t||void 0).toString()}function br(t,e){let r=t.indexOf(`<${e}>`),s=t.indexOf(`</${e}>`,r);return r!==-1&&s!==-1?t.slice(r+e.length+2,s):""}function Wu(t){if(t&&t.error){let e=new Error(t.message);throw Object.assign(e,t.error),e}return t}function Ku(t,e){if(!(e!=null&&typeof e.url=="string"&&(typeof e.fields=="object"||e.fields==null)))throw new TypeError(`AwsS3: got incorrect result from 'getUploadParameters()' for file '${t.name}', expected an object '{ url, method, fields, headers }' but got '${JSON.stringify(e)}' instead.
See https://uppy.io/docs/aws-s3/#getUploadParameters-file for more on the expected format.`);if(!(e.method==null||/^p(u|os)t$/i.test(e.method)))throw new TypeError(`AwsS3: got incorrect method from 'getUploadParameters()' for file '${t.name}', expected  'PUT' or 'POST' but got '${e.method}' instead.
See https://uppy.io/docs/aws-s3/#getUploadParameters-file for more on the expected format.`)}function Gu(t,e){if(!Si(t,e))return;let r=br(t,"Message");return new Error(r)}var In=!1,pe=Et("client"),be=Et("requests"),gt=Et("uploader"),vr=Et("handleUpload"),_r=Et("setCompanionHeaders"),Pi=Et("getCompanionClientArgs");qn=Symbol.for("uppy test: getClient");var yt=class extends Ue{constructor(e,r){if(r?.shouldUseMultipart!=null)return new Ft(e,r);super(e,r),Object.defineProperty(this,pe,{writable:!0,value:void 0}),Object.defineProperty(this,be,{writable:!0,value:void 0}),Object.defineProperty(this,gt,{writable:!0,value:void 0}),Object.defineProperty(this,vr,{writable:!0,value:async i=>{let o=Object.create(null);function n(h){var c;let{id:f}=h;(c=o[f])==null||c.abort()}this.uppy.on("file-removed",n);let a=this.uppy.getFilesByIds(i),l=es(a),d=ts(l);this.uppy.emit("upload-start",d);let p=q(this,be)[be].wrapPromiseFunction(h=>this.opts.getUploadParameters(h)),u=i.length;return Promise.allSettled(i.map((h,c)=>(o[h]=p(this.uppy.getFile(h)),o[h].then(f=>{delete o[h];let b=this.uppy.getFile(h);Ku(b,f);let{method:_="POST",url:v,fields:F,headers:x}=f,A={method:_,formData:_.toUpperCase()==="POST",endpoint:v,allowedMetaFields:F?Object.keys(F):[]};return x&&(A.headers=x),this.uppy.setFileState(b.id,{meta:{...b.meta,...F},xhrUpload:A}),this.uploadFile(b.id,c,u)}).catch(f=>{delete o[h];let b=this.uppy.getFile(h);return this.uppy.emit("upload-error",b,f),Promise.reject(f)})))).finally(()=>{this.uppy.off("file-removed",n)})}}),Object.defineProperty(this,_r,{writable:!0,value:()=>(q(this,pe)[pe].setCompanionHeaders(this.opts.companionHeaders),Promise.resolve())}),Object.defineProperty(this,Pi,{writable:!0,value:i=>{let o=q(this,gt)[gt].getOptions(i),n=Array.isArray(o.allowedMetaFields)?o.allowedMetaFields:Object.keys(i.meta);return{...i.remote.body,protocol:"multipart",endpoint:o.endpoint,size:i.data.size,fieldname:o.fieldName,metadata:Object.fromEntries(n.map(a=>[a,i.meta[a]])),httpMethod:o.method,useFormData:o.formData,headers:typeof o.headers=="function"?o.headers(i):o.headers}}}),this.type="uploader",this.id=this.opts.id||"AwsS3",this.title="AWS S3",this.defaultLocale=Bn;let s={timeout:30*1e3,limit:0,allowedMetaFields:[],getUploadParameters:this.getUploadParameters.bind(this),shouldUseMultipart:!1,companionHeaders:{}};if(this.opts={...s,...r},r?.allowedMetaFields===void 0&&"metaFields"in this.opts)throw new Error("The `metaFields` option has been renamed to `allowedMetaFields`.");this.i18nInit(),q(this,pe)[pe]=new ve(e,r),q(this,be)[be]=new Pt(this.opts.limit)}[qn](){return q(this,pe)[pe]}get client(){return q(this,pe)[pe]}set client(e){q(this,pe)[pe]=e}getUploadParameters(e){if(!this.opts.companionUrl)throw new Error("Expected a `companionUrl` option containing a Companion address.");let r=e.meta.name,{type:s}=e.meta,i=Object.fromEntries(this.opts.allowedMetaFields.filter(n=>e.meta[n]!=null).map(n=>[`metadata[${n}]`,e.meta[n].toString()])),o=new URLSearchParams({filename:r,type:s,...i});return q(this,pe)[pe].get(`s3/params?${o}`).then(Wu)}uploadFile(e,r,s){let i=this.uppy.getFile(e);if(this.uppy.log(`uploading ${r} of ${s}`),i.error)throw new Error(i.error);if(i.isRemote){let o=()=>q(this,be)[be],n=new AbortController,a=d=>{d.id===i.id&&n.abort()};this.uppy.on("file-removed",a);let l=this.uppy.getRequestClientForFile(i).uploadRemoteFile(i,q(this,Pi)[Pi](i),{signal:n.signal,getQueue:o});return q(this,be)[be].wrapSyncFunction(()=>{this.uppy.off("file-removed",a)},{priority:-1})(),l}return q(this,gt)[gt].uploadLocalFile(i,r,s)}install(){let{uppy:e}=this;e.addPreProcessor(q(this,_r)[_r]),e.addUploader(q(this,vr)[vr]);function r(i,o){let n=this;return Si(i,o)?{location:Hu(o.responseURL,br(i,"Location")),bucket:br(i,"Bucket"),key:br(i,"Key"),etag:br(i,"ETag")}:n.method.toUpperCase()==="POST"?(In||(e.log("[AwsS3] No response data found, make sure to set the success_action_status AWS SDK option to 201. See https://uppy.io/docs/aws-s3/#POST-Uploads","warning"),In=!0),{location:null}):o.responseURL?{location:o.responseURL.replace(/\?.*$/,"")}:{location:null}}let s={fieldName:"file",responseUrlFieldName:"location",timeout:this.opts.timeout,[Zr]:q(this,be)[be],responseType:"text",getResponseData:this.opts.getResponseData||r,getResponseError:Gu};s.i18n=this.i18n,q(this,gt)[gt]=new yr(e,s)}uninstall(){this.uppy.removePreProcessor(q(this,_r)[_r]),this.uppy.removeUploader(q(this,vr)[vr])}};yt.VERSION=zu.version;window.Uppy=kr;window.AwsS3=yt;window.DragDrop=Ie;window.StatusBar=qe;function Ti({state:t,maxFiles:e,maxSize:r,directory:s,companionUrl:i,csrfToken:o}){return{uppy:null,state:t,uploadedFiles:[],bytesToSize(n){let a=["Bytes","KB","MB","GB","TB"];if(n===0)return"n/a";let l=parseInt(Math.floor(Math.log(n)/Math.log(1024)),10);return l===0?`${n} ${a[l]}`:`${(n/1024**l).toFixed(1)} ${a[l]}`},init:function(){this.state&&(this.uploadedFiles=[{name:this.state,type:null,size:null}]),this.uppy=new kr({id:"uppy",autoProceed:!0,debug:!0,restrictions:{maxNumberOfFiles:e,maxFileSize:r,minNumberOfFiles:1},onBeforeUpload:n=>{let a={};return Object.keys(n).forEach(l=>{a[l]={...n[l],name:`${s}/${n[l].name}`}}),a}}),this.uppy.use(Ie,{target:".uppy__input"}).use(qe,{target:".uppy__progress-bar"}).use(yt,{limit:6,companionUrl:i,companionHeaders:{"X-CSRF-TOKEN":o,shouldUseMultipart:n=>n.size>100*2**20}}),this.uppy.on("file-added",n=>{Ti.upload&&Ti.upload()}),this.uppy.on("upload-success",(n,a)=>{this.state=a.body.path,e===1?this.uploadedFiles=[n]:this.uploadedFiles=[...this.uploadedFiles,n]})}}}export{Ti as default};
/*! Bundled license information:

classnames/index.js:
  (*!
  	Copyright (c) 2018 Jed Watson.
  	Licensed under the MIT License (MIT), see
  	http://jedwatson.github.io/classnames
  *)

@uppy/utils/lib/Translator.js:
  (**
   * Takes a string with placeholder variables like `%{smart_count} file selected`
   * and replaces it with values from options `{smart_count: 5}`
   *
   * @license https://github.com/airbnb/polyglot.js/blob/master/LICENSE
   * taken from https://github.com/airbnb/polyglot.js/blob/master/lib/polyglot.js#L299
   *
   * @param phrase that needs interpolation, with placeholders
   * @param options with values that will be used to replace placeholders
   *)
*/
